<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>「旅行旅上」智慧旅遊規劃 APP - 完整功能規格書</title>
    <style>
        /* 適合PDF輸出的樣式 */
        @page {
            margin: 2cm;
            @bottom-center {
                content: "頁 " counter(page) " / " counter(pages);
                font-size: 10pt;
                color: #666;
                font-family: 'Microsoft JhengHei', Arial, sans-serif;
            }
        }
        
        body {
            font-family: 'Microsoft JhengHei', 'Segoe UI', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            font-size: 11pt;
            max-width: 21cm;
            margin: 0 auto;
            background: #fff;
        }
        
        /* 封面樣式 */
        .cover-page {
            height: 29.7cm;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            page-break-after: always;
        }
        
        .cover-title {
            color: #1a365d;
            font-size: 32pt;
            font-weight: bold;
            margin-bottom: 20px;
            line-height: 1.2;
        }
        
        .cover-subtitle {
            color: #2d3748;
            font-size: 18pt;
            margin-bottom: 40px;
        }
        
        .cover-tagline {
            color: #4a5568;
            font-size: 14pt;
            font-style: italic;
            margin-bottom: 60px;
        }
        
        .cover-info {
            color: #718096;
            font-size: 10pt;
            margin-top: 100px;
        }
        
        /* 目錄樣式 */
        .toc {
            page-break-after: always;
        }
        
        .toc h2 {
            color: #1a365d;
            font-size: 20pt;
            margin-bottom: 30px;
            padding-bottom: 10px;
            border-bottom: 3px solid #4299e1;
        }
        
        .toc-item {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }
        
        .toc-item a {
            color: #2d3748;
            text-decoration: none;
            display: block;
            padding: 4px 0;
        }
        
        .toc-item a::before {
            content: "• ";
            color: #4299e1;
            position: absolute;
            left: 0;
        }
        
        .toc-subitem {
            margin-left: 20px;
            font-size: 10pt;
        }
        
        /* 標題樣式 */
        h1 {
            color: #1a365d;
            font-size: 24pt;
            text-align: center;
            margin-top: 1.5cm;
            margin-bottom: 0.8cm;
            border-bottom: 3px solid #4299e1;
            padding-bottom: 15px;
            page-break-before: always;
        }
        
        h2 {
            color: #2d3748;
            font-size: 18pt;
            margin-top: 1.2cm;
            margin-bottom: 0.6cm;
            padding-bottom: 8px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        h3 {
            color: #4a5568;
            font-size: 14pt;
            margin-top: 0.8cm;
            margin-bottom: 0.4cm;
        }
        
        h4 {
            color: #718096;
            font-size: 12pt;
            margin-top: 0.6cm;
            margin-bottom: 0.3cm;
        }
        
        /* 表格樣式 */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 0.8cm 0;
            font-size: 10pt;
            page-break-inside: avoid;
        }
        
        th {
            background-color: #edf2f7;
            color: #2d3748;
            font-weight: bold;
            text-align: left;
            padding: 10px 12px;
            border: 1px solid #cbd5e0;
        }
        
        td {
            padding: 10px 12px;
            border: 1px solid #cbd5e0;
            vertical-align: top;
        }
        
        tr:nth-child(even) {
            background-color: #f7fafc;
        }
        
        /* 功能卡樣式 */
        .function-card {
            border: 1px solid #cbd5e0;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            background: #fff;
            page-break-inside: avoid;
        }
        
        .function-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .function-icon {
            font-size: 20px;
            margin-right: 12px;
            background: #4299e1;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .function-title {
            font-weight: bold;
            color: #2b6cb0;
            font-size: 13pt;
        }
        
        .function-meta {
            background: #f7fafc;
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 10pt;
        }
        
        /* 強調框樣式 */
        .highlight-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            page-break-inside: avoid;
        }
        
        .warning-box {
            background: #fff5f5;
            border-left: 4px solid #fc8181;
            padding: 15px;
            margin: 15px 0;
        }
        
        .info-box {
            background: #e6fffa;
            border-left: 4px solid #38b2ac;
            padding: 15px;
            margin: 15px 0;
        }
        
        /* 代碼區塊 */
        .code-block {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 10pt;
            border-radius: 6px;
            overflow-x: auto;
            page-break-inside: avoid;
        }
        
        /* 步驟樣式 */
        .step-container {
            counter-reset: step-counter;
            margin: 20px 0;
        }
        
        .step {
            position: relative;
            padding-left: 50px;
            margin: 15px 0;
            min-height: 40px;
        }
        
        .step::before {
            counter-increment: step-counter;
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            width: 32px;
            height: 32px;
            background: #4299e1;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        /* 標籤樣式 */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 9pt;
            font-weight: bold;
            margin: 2px 4px;
        }
        
        .badge-mvp { background: #c6f6d5; color: #22543d; }
        .badge-phase2 { background: #fed7d7; color: #742a2a; }
        .badge-phase3 { background: #e9d8fd; color: #44337a; }
        .badge-tech { background: #bee3f8; color: #2c5282; }
        .badge-ai { background: #fed7d7; color: #c53030; }
        
        /* 分頁控制 */
        .page-break {
            page-break-before: always;
        }
        
        .keep-together {
            page-break-inside: avoid;
        }
        
        /* 頁腳 */
        .footer {
            text-align: center;
            font-size: 9pt;
            color: #718096;
            margin-top: 2cm;
            padding-top: 10px;
            border-top: 1px solid #e2e8f0;
        }
        
        /* 響應式調整 */
        @media print {
            body {
                font-size: 10pt;
            }
            
            h1 { font-size: 22pt; }
            h2 { font-size: 16pt; }
            h3 { font-size: 13pt; }
            
            .function-card {
                border: 1px solid #ddd;
            }
        }
    </style>
</head>
<body>

    <!-- 封面頁 -->
    <div class="cover-page">
        <div class="cover-title">「旅行旅上」智慧旅遊規劃 APP</div>
        <div class="cover-subtitle">智慧行程規劃 × 演算法決策 × 盲盒體驗</div>
        <div class="cover-tagline">你的旅遊行囊，重新定義旅遊體驗</div>
        <div class="cover-info">
            <div>完整功能規格書 v2.0</div>
            <div>最後更新：2025年12月23日</div>
            <div>機密等級：內部使用</div>
        </div>
    </div>

    <!-- 目錄 -->
    <div class="toc">
        <h2>📑 目錄</h2>
        
        <div class="toc-item"><a href="#section-1">一、產品核心定位與價值</a></div>
        <div class="toc-subitem"><a href="#section-1-1">1.1 一句話定位</a></div>
        <div class="toc-subitem"><a href="#section-1-2">1.2 目標用戶畫像</a></div>
        <div class="toc-subitem"><a href="#section-1-3">1.3 三大產品支柱</a></div>
        
        <div class="toc-item"><a href="#section-2">二、基礎核心功能（Standard Features）</a></div>
        <div class="toc-subitem"><a href="#section-2-1">2.1 使用者與帳號管理</a></div>
        <div class="toc-subitem"><a href="#section-2-2">2.2 行程建立與管理</a></div>
        <div class="toc-subitem"><a href="#section-2-3">2.3 地點搜尋與地圖整合</a></div>
        <div class="toc-subitem"><a href="#section-2-4">2.4 提醒與通知系統</a></div>
        <div class="toc-subitem"><a href="#section-2-5">2.5 行程分享與協作</a></div>
        
        <div class="toc-item"><a href="#section-3">三、智慧升級功能（AI × 演算法核心）</a></div>
        <div class="toc-subitem"><a href="#section-3-1">3.1 時間碎片 × 路徑最佳化演算法</a></div>
        <div class="toc-subitem"><a href="#section-3-2">3.2 LLM 賦能的行程助手</a></div>
        <div class="toc-subitem"><a href="#section-3-3">3.3 不踩雷系統（情感分析）</a></div>
        
        <div class="toc-item"><a href="#section-4">四、創新體驗功能（Game-Changing Features）</a></div>
        <div class="toc-subitem"><a href="#section-4-1">4.1 盲盒式旅行體驗</a></div>
        <div class="toc-subitem"><a href="#section-4-2">4.2 隨機探索工具</a></div>
        <div class="toc-subitem"><a href="#section-4-3">4.3 行程視覺化預告片</a></div>
        
        <div class="toc-item"><a href="#section-5">五、實用生活細節（Daily Enhancements）</a></div>
        <div class="toc-subitem"><a href="#section-5-1">5.1 智慧行李清單系統</a></div>
        <div class="toc-subitem"><a href="#section-5-2">5.2 多人協作與預算管理</a></div>
        <div class="toc-subitem"><a href="#section-5-3">5.3 交通銜接優化</a></div>
        
        <div class="toc-item"><a href="#section-6">六、技術架構與開發指南</a></div>
        <div class="toc-subitem"><a href="#section-6-1">6.1 技術棧選擇</a></div>
        <div class="toc-subitem"><a href="#section-6-2">6.2 團隊分工建議（1 Mac + 4 Windows）</a></div>
        <div class="toc-subitem"><a href="#section-6-3">6.3 跨平台協作解決方案</a></div>
        
        <div class="toc-item"><a href="#section-7">七、開發時程與優先級</a></div>
        <div class="toc-subitem"><a href="#section-7-1">7.1 MVP 版本功能</a></div>
        <div class="toc-subitem"><a href="#section-7-2">7.2 第二階段功能</a></div>
        <div class="toc-subitem"><a href="#section-7-3">7.3 第三階段功能</a></div>
        
        <div class="toc-item"><a href="#section-8">八、技術實現示例</a></div>
        <div class="toc-subitem"><a href="#section-8-1">8.1 自動刪除過期行程</a></div>
        <div class="toc-subitem"><a href="#section-8-2">8.2 年度行程回顧功能</a></div>
    </div>

    <!-- 正文開始 -->
    <h1 id="section-1">一、產品核心定位與價值</h1>
    
    <div class="highlight-box">
        <h2 id="section-1-1">🎯 一句話定位</h2>
        <p style="font-size: 14pt; font-weight: bold;">幫「有選擇困難、怕踩雷、不想動腦」的旅客，用 AI 與演算法自動排出「安全、順路、有驚喜」的完美行程。</p>
    </div>

    <h2 id="section-1-2">👥 目標用戶畫像</h2>
    <table>
        <thead>
            <tr>
                <th style="width: 15%;">用戶類型</th>
                <th style="width: 25%;">核心痛點</th>
                <th style="width: 30%;">我們如何解決</th>
                <th style="width: 30%;">關鍵功能</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>懶人旅者</strong></td>
                <td>行程規劃好麻煩<br>查資料查到厭世</td>
                <td>一鍵生成行程<br>自動化規劃</td>
                <td>盲盒旅行體驗<br>AI行程助手</td>
            </tr>
            <tr>
                <td><strong>效率旅者</strong></td>
                <td>景點間交通不順<br>浪費寶貴時間</td>
                <td>演算法優化路線<br>智能時間管理</td>
                <td>路徑最佳化引擎<br>碎片補位系統</td>
            </tr>
            <tr>
                <td><strong>怕雷旅者</strong></td>
                <td>網美照騙<br>到現場才發現踩雷</td>
                <td>即時負評分析<br>風險預警系統</td>
                <td>不踩雷系統<br>即時評論情感分析</td>
            </tr>
            <tr>
                <td><strong>團體旅者</strong></td>
                <td>意見不合<br>預算難算<br>容易走散</td>
                <td>多人協作工具<br>自動分帳計算</td>
                <td>多人即時協作<br>預算分攤系統<br>防走散模式</td>
            </tr>
            <tr>
                <td><strong>臨時旅者</strong></td>
                <td>突然有空檔<br>不知去哪</td>
                <td>即時推薦系統<br>空檔填補機制</td>
                <td>隨機探索工具<br>碎片補位系統</td>
            </tr>
        </tbody>
    </table>

    <h2 id="section-1-3">🏗️ 三大產品支柱</h2>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">📅</div>
            <div>
                <div class="function-title">基礎行程管理</div>
                <div style="color: #718096; font-size: 10pt;">可靠的工具 - 行程不漏接、資料隨身帶</div>
            </div>
        </div>
        <div class="function-meta">
            <strong>包含功能：</strong> 行程CRUD、地圖導航、分享協作、離線使用、提醒通知
        </div>
        <p>提供完整的行程管理基礎功能，確保使用者可以輕鬆創建、編輯、查看和分享行程。</p>
    </div>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">🧠</div>
            <div>
                <div class="function-title">智慧演算法引擎</div>
                <div style="color: #718096; font-size: 10pt;">聰明的腦袋 - 幫你避雷、省時、做決定</div>
            </div>
        </div>
        <div class="function-meta">
            <strong>包含功能：</strong> 路徑最佳化、不踩雷系統、LLM助手、情感分析、行為學習
        </div>
        <p>利用AI與機器學習技術，為行程規劃提供智能建議、風險預警和個性化推薦。</p>
    </div>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">🎮</div>
            <div>
                <div class="function-title">創新體驗玩法</div>
                <div style="color: #718096; font-size: 10pt;">旅行的樂趣 - 增加驚喜感、紀念性與儀式感</div>
            </div>
        </div>
        <div class="function-meta">
            <strong>包含功能：</strong> 盲盒旅行、隨機探索、行程預告片、旅遊成就、足跡系統
        </div>
        <p>通過遊戲化設計和創新功能，讓旅遊規劃和執行過程變得更加有趣和難忘。</p>
    </div>

    <div class="page-break"></div>

    <h1 id="section-2">二、基礎核心功能（Standard Features）</h1>
    
    <h2 id="section-2-1">👤 使用者與帳號管理</h2>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">🔐</div>
            <div class="function-title">註冊與登入系統</div>
        </div>
        <div class="step-container">
            <div class="step"><strong>支援多種登入方式：</strong> Email、手機號碼、Google OAuth、Apple ID</div>
            <div class="step"><strong>個人資料設定：</strong> 姓名、性別、年齡、旅遊偏好（美食/景點/休閒/親子）</div>
            <div class="step"><strong>興趣權重量化：</strong> 數值化設定，用於路徑最佳化演算法</div>
            <div class="step"><strong>偏好學習：</strong> 系統會根據使用行為自動調整推薦權重</div>
        </div>
        <div class="warning-box">
            <strong>🔧 技術細節：</strong> 使用JWT token進行身份驗證，偏好設定存儲在用戶資料庫中，影響TSP路徑排序和盲盒行程生成。
        </div>
    </div>

    <h2 id="section-2-2">📝 行程建立與管理</h2>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">➕</div>
            <div class="function-title">CRUD 操作完整流程</div>
        </div>
        <table>
            <tr>
                <th style="width: 20%;">操作</th>
                <th style="width: 40%;">詳細步驟</th>
                <th style="width: 40%;">技術實現</th>
            </tr>
            <tr>
                <td><strong>新增行程</strong></td>
                <td>1. 選擇日期時間<br>2. 輸入地點/活動<br>3. 設定交通方式<br>4. 添加備註</td>
                <td>日期選擇器 + 地點搜索API + 交通方式數據庫</td>
            </tr>
            <tr>
                <td><strong>編輯行程</strong></td>
                <td>1. 點擊要修改的行程<br>2. 更新時間/地點/交通<br>3. 保存變更</td>
                <td>即時同步到雲端 + 版本控制</td>
            </tr>
            <tr>
                <td><strong>刪除行程</strong></td>
                <td>1. 左滑或長按行程<br>2. 確認刪除提示<br>3. 刪除成功通知</td>
                <td>軟刪除標記 + 回收站功能</td>
            </tr>
            <tr>
                <td><strong>瀏覽檢視</strong></td>
                <td>• 日曆模式：月/週/日檢視<br>• 列表模式：時間順序排列<br>• 地圖模式：地理分佈顯示</td>
                <td>三種檢視切換 + 拖拉排序功能</td>
            </tr>
        </table>
        <div class="info-box">
            <strong>✨ 功能亮點：</strong> 支援多日行程規劃、離線瀏覽、完成率統計、放棄點數追蹤。
        </div>
    </div>

    <h2 id="section-2-3">🗺️ 地點搜尋與地圖整合</h2>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">🔍</div>
            <div class="function-title">智能搜索與導航系統</div>
        </div>
        <div class="step-container">
            <div class="step"><strong>多維度搜索：</strong> 景點名稱、類型（美食/文化/娛樂）、關鍵字</div>
            <div class="step"><strong>智能篩選：</strong> 距離（1km/3km/5km）、評分（4.0+）、熱門度、價格區間</div>
            <div class="step"><strong>地圖整合：</strong> Google Maps API，在地圖上標示所有行程點</div>
            <div class="step"><strong>即時導航：</strong> 一鍵跳轉到Google Maps/Apple Maps進行導航</div>
            <div class="step"><strong>交通顯示：</strong> 即時交通擁塞狀況、預計到達時間</div>
        </div>
        <div class="warning-box">
            <strong>📍 技術實現：</strong> 使用Google Places API進行地點搜索，Google Maps Embed API顯示地圖，交通數據來自Google Directions API。
        </div>
    </div>

    <h2 id="section-2-4">⏰ 提醒與通知系統</h2>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">🔔</div>
            <div class="function-title">智能提醒機制</div>
        </div>
        <table>
            <tr>
                <th style="width: 30%;">提醒類型</th>
                <th style="width: 35%;">觸發條件</th>
                <th style="width: 35%;">用戶操作</th>
            </tr>
            <tr>
                <td><strong>行程開始提醒</strong></td>
                <td>• 自訂提前時間（10/30/60分鐘）<br>• 根據交通狀況動態調整</td>
                <td>• 點擊查看詳情<br>• 一鍵延後提醒<br>• 標記為已完成</td>
            </tr>
            <tr>
                <td><strong>行程異動通知</strong></td>
                <td>• 協作成員修改行程<br>• 天氣變化影響行程<br>• 交通延誤或取消</td>
                <td>• 查看修改內容<br>• 同意/拒絕變更<br>• 提出替代方案</td>
            </tr>
            <tr>
                <td><strong>即時重要通知</strong></td>
                <td>• 景點臨時關閉<br>• 交通嚴重延誤<br>• 惡劣天氣警告</td>
                <td>• 緊急處理建議<br>• 備用方案推薦<br>• 安全注意事項</td>
            </tr>
        </table>
        <div class="info-box">
            <strong>⚡ 技術整合：</strong> 使用Firebase Cloud Messaging (FCM) 進行推播通知，結合天氣API和交通API實現智能提醒。
        </div>
    </div>

    <div class="page-break"></div>

    <h2 id="section-2-5">🤝 行程分享與協作</h2>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">📤</div>
            <div class="function-title">多人協作系統</div>
        </div>
        <div class="step-container">
            <div class="step"><strong>分享方式：</strong> 生成唯一連結，可透過訊息、Email、社群分享</div>
            <div class="step"><strong>權限管理：</strong> 三級權限（擁有者、編輯者、檢視者）</div>
            <div class="step"><strong>即時同步：</strong> 所有成員的修改即時顯示，使用WebSocket保持連線</div>
            <div class="step"><strong>版本控制：</strong> 保留修改歷史，可回溯到任意版本</div>
            <div class="step"><strong>變更追蹤：</strong> 顯示誰在何時修改了什麼內容</div>
        </div>
        
        <h4>📊 協作流程圖</h4>
        <div style="background: #f7fafc; padding: 15px; border-radius: 6px; margin: 15px 0;">
            <strong>1. 創建行程</strong> → <strong>2. 生成分享連結</strong> → <strong>3. 設定權限</strong><br>
            → <strong>4. 分享給旅伴</strong> → <strong>5. 多人即時編輯</strong> → <strong>6. 自動同步更新</strong>
        </div>
        
        <div class="warning-box">
            <strong>🔧 技術架構：</strong> 使用Firebase Realtime Database或Socket.io實現即時同步，每筆修改都有時間戳和用戶ID記錄。
        </div>
    </div>

    <h1 id="section-3">三、智慧升級功能（AI × 演算法核心）</h1>
    
    <div class="highlight-box">
        <h2>🚀 AI驅動的智能旅遊體驗</h2>
        <p>利用最先進的機器學習和自然語言處理技術，為用戶提供個性化、智能化的旅遊規劃服務。</p>
    </div>

    <h2 id="section-3-1">⚡ 時間碎片 × 路徑最佳化演算法</h2>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">🔄</div>
            <div class="function-title">TSP變體演算法系統</div>
        </div>
        
        <h4>🎯 使用情境</h4>
        <ul>
            <li>用戶只有2小時空檔，想最大化利用時間</li>
            <li>安排了5個景點，但不知道怎麼走最順</li>
            <li>想避開擁塞時段和人潮</li>
        </ul>
        
        <h4>🔢 演算法設計</h4>
        <div style="display: flex; gap: 20px; margin: 15px 0;">
            <div style="flex: 1; background: #e6fffa; padding: 15px; border-radius: 6px;">
                <strong>貪婪演算法 (Greedy Algorithm)</strong><br>
                • 快速生成可行路徑<br>
                • 時間複雜度低<br>
                • 適合即時計算
            </div>
            <div style="flex: 1; background: #ebf8ff; padding: 15px; border-radius: 6px;">
                <strong>基因演算法 (Genetic Algorithm)</strong><br>
                • 全域優化搜尋<br>
                • 考慮多種約束條件<br>
                • 生成最優解
            </div>
        </div>
        
        <h4>⚖️ 考量因子權重</h4>
        <table>
            <tr>
                <th>因子</th>
                <th>權重</th>
                <th>說明</th>
                <th>數據來源</th>
            </tr>
            <tr>
                <td>交通時間</td>
                <td>30%</td>
                <td>點對點移動時間</td>
                <td>Google Directions API</td>
            </tr>
            <tr>
                <td>興趣匹配</td>
                <td>25%</td>
                <td>與用戶偏好的契合度</td>
                <td>用戶偏好數據庫</td>
            </tr>
            <tr>
                <td>熱門程度</td>
                <td>20%</td>
                <td>景點評分和人氣</td>
                <td>Google Places API</td>
            </tr>
            <tr>
                <td>營業時間</td>
                <td>15%</td>
                <td>避免到達時已關閉</td>
                <td>商家營業數據</td>
            </tr>
            <tr>
                <td>即時擁塞</td>
                <td>10%</td>
                <td>避開人潮和車潮</td>
                <td>即時交通數據</td>
            </tr>
        </table>
        
        <div class="info-box">
            <strong>📈 實際案例：</strong> 3小時空檔 → 系統計算出 A(美食) → B(博物館) → C(觀景台) 路徑，總體分數85分，避免步行過度、避開塞車時段、確保營業時間內到達。
        </div>
    </div>

    <div class="page-break"></div>

    <h2 id="section-3-2">🤖 LLM 賦能的行程助手</h2>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">💬</div>
            <div class="function-title">生成式AI旅遊助手</div>
        </div>
        
        <h4>🛠️ 技術架構</h4>
        <div style="background: #f7fafc; padding: 15px; border-radius: 6px; margin: 15px 0;">
            <strong>AI模型選擇：</strong> GPT-4o-mini 或 Gemini API<br>
            <strong>文本生成：</strong> 景點介紹、行程概述、旅遊貼士<br>
            <strong>語音功能：</strong> Text-to-Speech 語音導覽<br>
            <strong>多語言：</strong> 支援中文、英文、日文、韓文
        </div>
        
        <h4>📋 操作流程</h4>
        <div class="step-container">
            <div class="step"><strong>1. 行程分析：</strong> 系統自動分析行程內容和地點資訊</div>
            <div class="step"><strong>2. 生成前言：</strong> 自動撰寫「旅遊手冊前言」介紹整個行程</div>
            <div class="step"><strong>3. 景點介紹：</strong> 為每個景點生成詳細的文字介紹</div>
            <div class="step"><strong>4. 語音導覽：</strong> 將文字轉換為語音，提供導覽服務</div>
            <div class="step"><strong>5. 個性化建議：</strong> 根據用戶偏好提供額外建議</div>
        </div>
        
        <div class="warning-box">
            <strong>🔧 實現細節：</strong> 使用OpenAI GPT API或Google Gemini API，每次請求包含行程結構、用戶偏好、地點資料，返回結構化的介紹內容。
        </div>
        
        <h4>🎙️ 語音導覽範例</h4>
        <div style="background: #fff5f5; padding: 15px; border-radius: 6px; margin: 15px 0; font-style: italic;">
            "歡迎來到台北101觀景台！這裡是台北的地標建築，總高度509公尺，曾經是世界最高建築..."
            <div style="text-align: right; margin-top: 10px; color: #718096; font-size: 9pt;">
                🔈 點擊播放語音導覽 | 📖 查看完整介紹
            </div>
        </div>
    </div>

    <h2 id="section-3-3">⚠️ 不踩雷系統（情感分析）</h2>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">🚫</div>
            <div class="function-title">負評預警系統</div>
        </div>
        
        <h4>🎯 使用情境</h4>
        <ul>
            <li>用戶擔心網紅景點最近有施工或服務問題</li>
            <li>想避免最近負評較多的餐廳</li>
            <li>確保選擇的住宿評價穩定</li>
        </ul>
        
        <h4>🔍 數據收集流程</h4>
        <div class="step-container">
            <div class="step"><strong>1. 評論爬取：</strong> 自動抓取Google Maps/TripAdvisor最近100則評論</div>
            <div class="step"><strong>2. 情感分析：</strong> 使用NLP技術分析每則評論的情感傾向</div>
            <div class="step"><strong>3. 關鍵字提取：</strong> 識別負面關鍵字（施工、髒亂、服務差等）</div>
            <div class="step"><strong>4. 風險評估：</strong> 計算負評比例和嚴重程度</div>
            <div class="step"><strong>5. 警告標示：</strong> 高風險地點標示「▲ 近期雷點警告」</div>
        </div>
        
        <h4>📊 情感分析技術架構</h4>
        <div class="code-block">
// 情感分析示例代碼 (Python)
from transformers import pipeline

# 加載預訓練模型
sentiment_analyzer = pipeline("sentiment-analysis")

# 分析評論情感
reviews = ["服務很好，環境整潔", "最近在施工，很吵", "食物普通，價格偏貴"]
results = sentiment_analyzer(reviews)

# 結果處理
for review, result in zip(reviews, results):
    print(f"評論: {review}")
    print(f"情感: {result['label']}, 信心度: {result['score']:.2f}")
    print("---")
        </div>
        
        <div class="info-box">
            <strong>📈 實際案例：</strong> 某景點平均評分4.5分，但近期評論中有80%提到「施工中」、「噪音大」、「部分區域關閉」，系統自動標示警告標籤並建議替代景點。
        </div>
        
        <h4>⚠️ 警告等級定義</h4>
        <table>
            <tr>
                <th style="width: 15%;">等級</th>
                <th style="width: 25%;">觸發條件</th>
                <th style="width: 30%;">顯示方式</th>
                <th style="width: 30%;">建議行動</th>
            </tr>
            <tr>
                <td><span style="color: #38a169;">● 低風險</span></td>
                <td>負評比例 < 10%<br>無嚴重關鍵字</td>
                <td>正常顯示，無特別標示</td>
                <td>可安心前往</td>
            </tr>
            <tr>
                <td><span style="color: #d69e2e;">▲ 中風險</span></td>
                <td>負評比例 10-30%<br>有少數負面關鍵字</td>
                <td>黃色提示圖標<br>「近期有部分負評」</td>
                <td>建議查看詳細評論</td>
            </tr>
            <tr>
                <td><span style="color: #e53e3e;">⚠️ 高風險</span></td>
                <td>負評比例 > 30%<br>多個嚴重負面關鍵字</td>
                <td>紅色警告標誌<br>「▲ 近期雷點警告」</td>
                <td>強烈建議考慮替代方案</td>
            </tr>
        </table>
    </div>

    <div class="page-break"></div>

    <h1 id="section-4">四、創新體驗功能（Game-Changing Features）</h1>
    
    <div class="highlight-box">
        <h2>🎮 重新定義旅遊體驗</h2>
        <p>透過遊戲化設計和創新互動，讓旅遊規劃不再枯燥，而是充滿驚喜和樂趣的體驗。</p>
    </div>

    <h2 id="section-4-1">🎁 盲盒式旅行體驗</h2>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">❓</div>
            <div class="function-title">The Russian Roulette of Travel</div>
        </div>
        
        <h4>🎯 功能定位</h4>
        <p>專門解決「選擇困難症」，提供隨機但可依偏好微調的行程體驗，適合不想花時間規劃的用戶。</p>
        
        <h4>🔄 完整使用流程</h4>
        <div class="step-container">
            <div class="step"><strong>1. 基本設定：</strong> 輸入預算範圍、旅行日期、旅伴人數</div>
            <div class="step"><strong>2. 偏好問卷：</strong> 填寫詳細的偏好調查問卷</div>
            <div class="step"><strong>3. 風險設定：</strong> 調整「冒險程度」滑桿（保守 ← → 冒險）</div>
            <div class="step"><strong>4. 生成行程：</strong> 點擊「命運左輪」按鈕，系統生成完整行程</div>
            <div class="step"><strong>5. 確認鎖定：</strong> 行程一旦生成即<strong>不可修改</strong>，時間鎖死</div>
        </div>
        
        <h4>📋 偏好問卷內容</h4>
        <table>
            <tr>
                <th style="width: 30%;">維度</th>
                <th style="width: 35%;">選項</th>
                <th style="width: 35%;">權重影響</th>
            </tr>
            <tr>
                <td><strong>當下心情</strong></td>
                <td>放鬆/冒險/美食/文化/購物</td>
                <td>影響景點類型的選擇比例</td>
            </tr>
            <tr>
                <td><strong>活動偏好</strong></td>
                <td>室內/戶外、靜態/動態、自然/都市</td>
                <td>決定行程的整體風格</td>
            </tr>
            <tr>
                <td><strong>飲食限制</strong></td>
                <td>葷食/素食、辣度偏好、過敏食材</td>
                <td>餐廳推薦的重要依據</td>
            </tr>
            <tr>
                <td><strong>體力水平</strong></td>
                <td>輕鬆/中等/挑戰</td>
                <td>影響每日步行距離和活動強度</td>
            </tr>
            <tr>
                <td><strong>驚喜程度</strong></td>
                <td>1-10分，完全可控到完全隨機</td>
                <td>決定系統自主決策的範圍</td>
            </tr>
        </table>
        
        <h4>🔧 技術設計細節</h4>
        <div style="background: #f7fafc; padding: 15px; border-radius: 6px; margin: 15px 0;">
            <strong>隨機演算法：</strong> 加權隨機選擇，結合問卷權重計算<br>
            <strong>安全檢查：</strong> 避免生成深夜偏僻地點或交通不便的路線<br>
            <strong>路徑優化：</strong> 即使隨機生成，仍同步執行路徑最佳化演算法<br>
            <strong>預算控制：</strong> 確保總費用不超過設定的預算範圍
        </div>
        
        <div class="info-box">
            <strong>✨ 功能亮點：</strong> 
            <ul>
                <li>增加行程的趣味性和刺激感</li>
                <li>適合「臨時決定旅遊」、「不想花腦力排行程」的用戶</li>
                <li>結合遊戲化元素，提升用戶參與度</li>
                <li>即使隨機生成，仍保證行程的合理性和安全性</li>
            </ul>
        </div>
    </div>

    <h2 id="section-4-2">🎲 隨機探索工具</h2>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">🎲</div>
            <div class="function-title">Dice Travel - On-the-Spot Decision</div>
        </div>
        
        <h4>🎯 功能定位</h4>
        <p>解決「人在現場不知道下一步怎麼走」的困境，將臨時決策變得有趣且可控。</p>
        
        <h4>📍 使用情境</h4>
        <ul>
            <li>在火車站，不知道該搭哪班車</li>
            <li>在商圈，不知道該吃哪家餐廳</li>
            <li>在景區，不知道該走哪條路線</li>
            <li>晚上空閒，不知道該去哪裡</li>
        </ul>
        
        <h4>🔄 操作流程</h4>
        <div class="step-container">
            <div class="step"><strong>1. 開啟模式：</strong> 打開APP，進入「隨機探索」頁面</div>
            <div class="step"><strong>2. 選擇項目：</strong> 選擇要隨機化的決策項目（單選或多選）</div>
            <div class="step"><strong>3. 設定限制：</strong> 設定範圍限制（距離、時間、價格等）</div>
            <div class="step"><strong>4. 隨機選擇：</strong> 點擊「擲骰子」或「隨機選擇」按鈕</div>
            <div class="step"><strong>5. 接受結果：</strong> 系統即時生成結果，使用者按結果行動</div>
        </div>
        
        <h4>🎯 可隨機化項目</h4>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 15px 0;">
            <div style="background: #e6fffa; padding: 10px; border-radius: 6px;">
                <strong>交通類</strong><br>
                • 月台選擇<br>
                • 車次選擇<br>
                • 下車站點<br>
                • 步行方向
            </div>
            <div style="background: #ebf8ff; padding: 10px; border-radius: 6px;">
                <strong>美食類</strong><br>
                • 餐廳類型<br>
                • 菜系選擇<br>
                • 價格區間<br>
                • 用餐時間
            </div>
            <div style="background: #fefcbf; padding: 10px; border-radius: 6px;">
                <strong>景點類</strong><br>
                • 景點類型<br>
                • 參觀順序<br>
                • 停留時間<br>
                • 探索路線
            </div>
            <div style="background: #fed7d7; padding: 10px; border-radius: 6px;">
                <strong>活動類</strong><br>
                • 娛樂活動<br>
                • 購物地點<br>
                • 休閒方式<br>
                • 拍照點位
            </div>
        </div>
        
        <h4>🔧 技術設計</h4>
        <div style="background: #f7fafc; padding: 15px; border-radius: 6px; margin: 15px 0;">
            <strong>隨機數生成：</strong> 使用加密安全的隨機數生成器 (CSPRNG)<br>
            <strong>規則限制：</strong> 依行程規則限制選擇範圍（交通可達性、時間限制）<br>
            <strong>即時數據：</strong> 結合即時位置、營業時間、交通狀況<br>
            <strong>保險機制：</strong> 確保選擇在安全合理的範圍內（如：餐廳必須在1公里內）
        </div>
        
        <h4>📋 實際範例</h4>
        <div style="background: #fff5f5; padding: 15px; border-radius: 6px; margin: 15px 0;">
            <strong>情境：</strong> 在台北車站，想隨機決定下一站<br>
            <strong>設定：</strong> 選擇「下車站點」，限制「30分鐘內可到達」<br>
            <strong>結果：</strong> 系統隨機選擇「松山站」<br>
            <strong>資訊：</strong> 顯示松山站周邊景點（饒河夜市、松山文創園區）<br>
            <strong>行動：</strong> 一鍵導航到台北車站月台，搭乘往松山的列車
        </div>
        
        <div class="info-box">
            <strong>✨ 功能亮點：</strong> 
            <ul>
                <li>增加探索冒險感，讓旅遊更有趣</li>
                <li>將「選擇困難」轉化為遊戲體驗</li>
                <li>提供即時、實用的決策建議</li>
                <li>結合實際限制，確保選擇的可行性</li>
            </ul>
        </div>
    </div>

    <div class="page-break"></div>

    <h1 id="section-5">五、實用生活細節（Daily Enhancements）</h1>
    
    <div class="highlight-box">
        <h2>✨ 貼心功能設計</h2>
        <p>關注旅行中的每一個小細節，解決實際痛點，提升整體旅遊體驗。</p>
    </div>

    <h2 id="section-5-1">🧳 智慧行李清單系統</h2>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">📋</div>
            <div class="function-title">三階式智慧清單生成</div>
        </div>
        
        <h4>🎯 使用情境</h4>
        <p>用戶在出發前感到焦慮，不確定該帶什麼裝備，擔心遺漏重要物品。</p>
        
        <h4>🔢 三層生成邏輯</h4>
        <table>
            <tr>
                <th style="width: 25%;">層級</th>
                <th style="width: 25%;">生成邏輯</th>
                <th style="width: 25%;">示例內容</th>
                <th style="width: 25%;">數據來源</th>
            </tr>
            <tr>
                <td><strong>1. 基礎必備層</strong></td>
                <td>根據旅遊天數計算</td>
                <td>• 換洗衣物：天數+1套備用<br>• 內衣褲/襪子：天數計算<br>• 個人藥品、行動電源</td>
                <td>用戶輸入的天數</td>
            </tr>
            <tr>
                <td><strong>2. 地點屬性層</strong></td>
                <td>根據目的地特徵匹配</td>
                <td>• 山區：防蚊液、薄長袖<br>• 海邊：防曬乳、拖鞋<br>• 城市：舒適鞋子、環保袋</td>
                <td>目的地經緯度+環境數據</td>
            </tr>
            <tr>
                <td><strong>3. 活動感應層</strong></td>
                <td>掃描行程關鍵字</td>
                <td>• 海邊/SUP：手機防水袋<br>• 溫泉：泳衣泳帽<br>• 登山：登山杖、水袋</td>
                <td>行程文字分析</td>
            </tr>
        </table>
        
        <h4>🏮 台灣在地化優化</h4>
        <div style="background: #f7fafc; padding: 15px; border-radius: 6px; margin: 15px 0;">
            <strong>數據收集：</strong> 從PTT、Dcard旅遊版、Google評論收集旅人經驗<br>
            <strong>關鍵字分析：</strong> 提取「忘了帶」、「還好有帶」、「後悔沒帶」相關內容<br>
            <strong>場景化建議：</strong> 根據台灣特有環境提供建議
        </div>
        
        <h4>📍 台灣場景回饋案例</h4>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 15px 0;">
            <div style="background: #e6fffa; padding: 10px; border-radius: 6px;">
                <strong>台南老街</strong><br>
                • 問題：70%旅人提到「老店只收現金」<br>
                • 解決：自動加入「千元現金備用」
            </div>
            <div style="background: #ebf8ff; padding: 10px; border-radius: 6px;">
                <strong>花東縱谷</strong><br>
                • 問題：小黑蚊叮咬嚴重<br>
                • 解決：自動加入「長袖薄外套」、「派卡瑞丁防蚊液」
            </div>
            <div style="background: #fed7d7; padding: 10px; border-radius: 6px;">
                <strong>外宿民宿</strong><br>
                • 問題：插座位置不佳<br>
                • 解決：自動加入「多孔擴充頭」、「延長線」
            </div>
        </div>
        
        <h4>🎨 UI/UX 設計細節</h4>
        <div class="step-container">
            <div class="step"><strong>互動式標註：</strong> 「已帶」勾選後變淡灰色並移至底部</div>
            <div class="step"><strong>智能過濾：</strong> 根據使用者類型過濾建議（親子/攝影/商務）</div>
            <div class="step"><strong>任務分配：</strong> 一鍵轉發旅伴，分配攜帶責任</div>
            <div class="step"><strong>學習機制：</strong> 記錄用戶的選擇習慣，優化未來建議</div>
        </div>
    </div>

    <!-- 添加到第5章節中，在「交通銜接與步行優化」之後 -->

<h2 id="section-5-4">🎯 行程「後悔率」標記系統</h2>

<div class="function-card">
    <div class="function-header">
        <div class="function-icon">📊</div>
        <div class="function-title">行為學習與智能推薦優化</div>
    </div>
    
    <h4>🎯 使用情境</h4>
    <p>解決「行程排很多但實際只去一半」的問題。某些行程實際執行時因疲累、距離過遠或興趣不足而被放棄，使用者無法直觀察覺自己「常後悔安排哪些類型的行程」。</p>
    
    <h4>🔍 問題分析</h4>
    <div style="background: #fff5f5; padding: 15px; border-radius: 6px; margin: 15px 0;">
        <strong>常見痛點：</strong>
        <ul>
            <li>老是排了「登山行程」但最後因體力不足放棄</li>
            <li>安排了「購物行程」但到現場發現沒興趣</li>
            <li>「長距離移動」的行程常常被跳過</li>
            <li>重複安排相同類型的「雷點行程」</li>
        </ul>
    </div>
    
    <h4>📋 系統設計架構</h4>
    <div style="background: #f7fafc; padding: 15px; border-radius: 6px; margin: 15px 0;">
        <strong>三步驟運作機制：</strong><br>
        1. <strong>資料蒐集</strong> → 2. <strong>後悔率計算</strong> → 3. <strong>智能應用</strong>
    </div>
    
    <h4>🔢 詳細工作流程</h4>
    <table>
        <tr>
            <th style="width: 20%;">階段</th>
            <th style="width: 40%;">操作流程</th>
            <th style="width: 40%;">技術實現</th>
        </tr>
        <tr>
            <td><strong>1. 資料蒐集</strong></td>
            <td>• 每個行程節點記錄狀態：✅已完成 / ❌跳過放棄<br>
                • 記錄跳過原因（可選）：太累、太遠、沒興趣、時間不夠<br>
                • 行程結束後自動儲存到用戶行為資料庫</td>
            <td>• 狀態追蹤數據表<br>
                • 時間戳記錄<br>
                • 用戶ID關聯</td>
        </tr>
        <tr>
            <td><strong>2. 後悔率計算</strong></td>
            <td>• 依行程類型分類：戶外景點、購物、美食、文化、娛樂等<br>
                • 計算公式：<br>
                <code>後悔率 = 跳過次數 ÷ 總安排次數 × 100%</code><br>
                • 設定門檻值（預設：跳過比例 > 30%）</td>
            <td>• 定期批次計算（每週一次）<br>
                • 使用Redis緩存計算結果<br>
                • 支持自定義門檻設定</td>
        </tr>
        <tr>
            <td><strong>3. 智能應用</strong></td>
            <td>• 高後悔率行程標記警告標誌<br>
                • 降低該類型行程的推薦權重<br>
                • 加入時彈出確認提示</td>
            <td>• 推薦演算法權重調整<br>
                • 前端提示組件<br>
                • 用戶偏好學習模型</td>
        </tr>
    </table>
    
    <h4>🏷️ 行程類型分類系統</h4>
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 15px 0;">
        <div style="background: #e6fffa; padding: 10px; border-radius: 6px;">
            <strong>活動強度類</strong><br>
            • 高強度：登山、單車、徒步<br>
            • 中強度：觀光、參觀、遊覽<br>
            • 低強度：咖啡廳、休息、放空
        </div>
        <div style="background: #ebf8ff; padding: 10px; border-radius: 6px;">
            <strong>時間需求類</strong><br>
            • 長時間：博物館、遊樂園<br>
            • 中等時間：餐廳、商店<br>
            • 短時間：拍照點、觀景台
        </div>
        <div style="background: #fefcbf; padding: 10px; border-radius: 6px;">
            <strong>距離成本類</strong><br>
            • 遠距離：郊區景點<br>
            • 中等距離：城市移動<br>
            • 短距離：步行可達
        </div>
    </div>
    
    <h4>⚠️ 警告與提示系統</h4>
    <div style="background: #fff5f5; padding: 15px; border-radius: 6px; margin: 15px 0;">
        <div style="display: flex; align-items: flex-start; margin-bottom: 10px;">
            <div style="background: #fed7d7; color: #c53030; padding: 5px 10px; border-radius: 4px; margin-right: 10px; font-weight: bold;">
                高後悔率警告
            </div>
            <div>
                <strong>「登山類行程」過去跳過率：42%</strong><br>
                您過去安排的5次登山行程中，有2次被跳過。<br>
                <span style="color: #718096; font-size: 12pt;">可能原因：體力消耗大、需要特殊裝備</span>
            </div>
        </div>
        
        <div style="display: flex; align-items: flex-start;">
            <div style="background: #fefcbf; color: #b7791f; padding: 5px 10px; border-radius: 4px; margin-right: 10px; font-weight: bold;">
                確認提示
            </div>
            <div>
                <strong>「此類行程過去常被跳過，是否仍要加入？」</strong><br>
                <button style="background: #38a169; color: white; border: none; padding: 8px 16px; border-radius: 4px; margin-right: 10px; cursor: pointer;">
                    仍要加入
                </button>
                <button style="background: #e2e8f0; color: #4a5568; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
                    查看替代方案
                </button>
            </div>
        </div>
    </div>
    
    <h4>📈 後台數據分析面板</h4>
    <div class="code-block">
// 後悔率計算API示例
router.get('/regret-analysis', auth, async (req, res) => {
    try {
        const userId = req.user.id;
        
        // 獲取用戶所有行程記錄
        const events = await Event.find({
            user_id: userId,
            is_deleted: false
        }).select('category status created_at');
        
        // 按類別分組統計
        const categoryStats = {};
        events.forEach(event => {
            if (!event.category) return;
            
            if (!categoryStats[event.category]) {
                categoryStats[event.category] = {
                    total: 0,
                    skipped: 0,
                    completed: 0
                };
            }
            
            categoryStats[event.category].total++;
            if (event.status === 'skipped') {
                categoryStats[event.category].skipped++;
            } else if (event.status === 'completed') {
                categoryStats[event.category].completed++;
            }
        });
        
        // 計算後悔率
        const regretRates = Object.entries(categoryStats).map(([category, stats]) => {
            const regretRate = stats.total > 0 ? (stats.skipped / stats.total) * 100 : 0;
            return {
                category,
                total: stats.total,
                skipped: stats.skipped,
                completed: stats.completed,
                regret_rate: regretRate.toFixed(1),
                warning_level: regretRate > 30 ? 'high' : regretRate > 15 ? 'medium' : 'low'
            };
        });
        
        // 按後悔率排序
        regretRates.sort((a, b) => b.regret_rate - a.regret_rate);
        
        res.json({
            user_id: userId,
            total_events: events.length,
            analysis_date: new Date(),
            regret_rates: regretRates,
            summary: {
                high_regret_categories: regretRates.filter(r => r.warning_level === 'high').length,
                most_regretted: regretRates[0] || null,
                least_regretted: regretRates[regretRates.length - 1] || null
            }
        });
        
    } catch (error) {
        res.status(500).json({ error: error.message });
    }
});
    </div>
    
    <h4>🎯 實際應用案例</h4>
    <div style="background: #e6fffa; padding: 15px; border-radius: 6px; margin: 15px 0;">
        <strong>用戶案例：小明（登山愛好者但體力有限）</strong><br><br>
        
        <strong>📊 歷史數據：</strong><br>
        • 安排登山行程：8次<br>
        • 實際完成：3次（37.5%）<br>
        • 跳過放棄：5次（62.5%）<br>
        • 後悔率：62.5% ⚠️<br><br>
        
        <strong>🤖 系統學習：</strong><br>
        1. 識別「登山類」為高後悔率行程類型<br>
        2. 分析跳過原因：體力不足（3次）、天氣不佳（1次）、時間不夠（1次）<br>
        3. 調整推薦策略<br><br>
        
        <strong>🔄 智能調整：</strong><br>
        1. <strong>降低權重：</strong> 登山行程推薦權重降低40%<br>
        2. <strong>替代推薦：</strong> 改推薦「輕鬆步道」、「觀景台」等低強度選項<br>
        3. <strong>條件提示：</strong> 若要加入登山行程，提示「建議評估當日體力狀態」
    </div>
    
    <div class="info-box">
        <strong>✨ 功能亮點：</strong> 
        <ul>
            <li><strong>行為學習：</strong> 不是猜測喜好，而是依實際行為學習</li>
            <li><strong>個性化調整：</strong> 每個用戶的後悔率計算都是獨立的</li>
            <li><strong>漸進式學習：</strong> 隨使用時間增加，準確度提升</li>
            <li><strong>用戶控制權：</strong> 提示但不禁用，用戶仍可自行決定</li>
            <li><strong>有效改善：</strong> 可降低「行程排很多但實際只去一半」的狀況達40%以上</li>
        </ul>
    </div>
</div>

<div class="page-break"></div>

<h2 id="section-5-5">⏱️ 行程碎片補位系統</h2>

<div class="function-card">
    <div class="function-header">
        <div class="function-icon">🧩</div>
        <div class="function-title">智能空檔時間利用</div>
    </div>
    
    <h4>🎯 使用情境</h4>
    <p>解決旅途中「不知道接下來要做什麼」的尷尬空檔。當出現行程提早結束、交通比預期順暢、臨時取消某一站等情形時，系統自動推薦適合的短時間行程，善用原本會被浪費的零碎時間。</p>
    
    <h4>🔍 常見空檔場景</h4>
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 15px 0;">
        <div style="background: #e6fffa; padding: 15px; border-radius: 6px;">
            <strong>⏰ 時間相關</strong><br>
            • 午餐提早30分鐘結束<br>
            • 景點參觀比預期快<br>
            • 下一班車還有45分鐘<br>
            • 預約時間還沒到
        </div>
        <div style="background: #ebf8ff; padding: 15px; border-radius: 6px;">
            <strong>🔄 行程變動</strong><br>
            • 臨時取消某一站<br>
            • 同伴遲到或早到<br>
            • 天氣變化調整行程<br>
            • 體力不支減少行程
        </div>
    </div>
    
    <h4>🔧 系統運作機制</h4>
    <div style="background: #f7fafc; padding: 15px; border-radius: 6px; margin: 15px 0; text-align: center;">
        <strong>1. 空檔偵測</strong> → <strong>2. 條件篩選</strong> → <strong>3. 智能推薦</strong><br>
        → <strong>4. 即時呈現</strong> → <strong>5. 一鍵加入</strong> → <strong>6. 動態調整</strong>
    </div>
    
    <h4>📋 補位行程篩選條件</h4>
    <table>
        <tr>
            <th style="width: 25%;">篩選維度</th>
            <th style="width: 35%;">具體條件</th>
            <th style="width: 20%;">權重</th>
            <th style="width: 20%;">技術實現</th>
        </tr>
        <tr>
            <td><strong>距離範圍</strong></td>
            <td>• 步行可達（< 1.5公里）<br>
                • 短程移動（< 3公里）<br>
                • 考慮當前交通工具</td>
            <td>30%</td>
            <td>Google Distance Matrix API</td>
        </tr>
        <tr>
            <td><strong>時間匹配</strong></td>
            <td>• 預估停留時間 ≤ 空檔時間<br>
                • 包含來回交通時間<br>
                • 預留10%緩衝時間</td>
            <td>25%</td>
            <td>時間計算引擎</td>
        </tr>
        <tr>
            <td><strong>營業狀態</strong></td>
            <td>• 當前營業中<br>
                • 不需事先預約<br>
                • 有即時空位/容量</td>
            <td>20%</td>
            <td>Google Places API<br>即時數據更新</td>
        </tr>
        <tr>
            <td><strong>行程相容</strong></td>
            <td>• 不影響後續主要行程<br>
                • 體力消耗合理<br>
                • 預算範圍內</td>
            <td>15%</td>
            <td>衝突檢測算法</td>
        </tr>
        <tr>
            <td><strong>用戶偏好</strong></td>
            <td>• 符合歷史偏好<br>
                • 避開高後悔率類型<br>
                • 驚喜程度可調</td>
            <td>10%</td>
            <td>推薦算法</td>
        </tr>
    </table>
    
    <h4>📱 用戶界面設計</h4>
    <div style="background: #fff5f5; padding: 15px; border-radius: 6px; margin: 15px 0;">
        <div style="background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h4 style="margin: 0;">⏱️ 發現空檔時間！</h4>
                <span style="background: #4299e1; color: white; padding: 4px 12px; border-radius: 12px; font-size: 12pt;">
                    45分鐘可用
                </span>
            </div>
            
            <p style="color: #718096; margin-bottom: 20px;">
                午餐提早結束，您有45分鐘空檔時間，系統為您推薦：
            </p>
            
            <!-- 推薦選項1 -->
            <div style="border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <strong>☕ 星巴克咖啡廳</strong>
                    <span style="color: #38a169;">★★★★☆ 4.3</span>
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 12pt; color: #718096; margin-bottom: 10px;">
                    <span>📍 步行5分鐘 | 350公尺</span>
                    <span>⏰ 建議停留：25分鐘</span>
                </div>
                <button style="background: #4299e1; color: white; border: none; padding: 8px 16px; border-radius: 4px; width: 100%; cursor: pointer;">
                    一鍵加入行程
                </button>
            </div>
            
            <!-- 推薦選項2 -->
            <div style="border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <strong>📚 誠品書店</strong>
                    <span style="color: #38a169;">★★★★☆ 4.5</span>
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 12pt; color: #718096; margin-bottom: 10px;">
                    <span>📍 步行8分鐘 | 650公尺</span>
                    <span>⏰ 建議停留：35分鐘</span>
                </div>
                <button style="background: #4299e1; color: white; border: none; padding: 8px 16px; border-radius: 4px; width: 100%; cursor: pointer;">
                    一鍵加入行程
                </button>
            </div>
            
            <!-- 推薦選項3 -->
            <div style="border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <strong>🏞️ 公園散步</strong>
                    <span style="color: #38a169;">★★★★☆ 4.2</span>
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 12pt; color: #718096; margin-bottom: 10px;">
                    <span>📍 步行3分鐘 | 200公尺</span>
                    <span>⏰ 建議停留：20分鐘</span>
                </div>
                <button style="background: #4299e1; color: white; border: none; padding: 8px 16px; border-radius: 4px; width: 100%; cursor: pointer;">
                    一鍵加入行程
                </button>
            </div>
            
            <div style="text-align: center; margin-top: 15px;">
                <button style="background: #e2e8f0; color: #4a5568; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
                    暫時不需要，跳過
                </button>
            </div>
        </div>
    </div>
    
    <h4>🔍 智能推薦算法</h4>
    <div class="code-block">
// 碎片補位推薦算法示例
async function findGapFillers(currentLocation, availableTime, userPreferences) {
    const recommendations = [];
    
    // 1. 獲取附近地點
    const nearbyPlaces = await getNearbyPlaces(currentLocation, {
        radius: 1500, // 1.5公里範圍
        types: ['cafe', 'restaurant', 'park', 'museum', 'store', 'viewpoint']
    });
    
    // 2. 篩選和評分
    for (const place of nearbyPlaces) {
        let score = 0;
        const reasons = [];
        
        // 距離評分（越近分數越高）
        const distanceScore = Math.max(0, 100 - (place.distance * 10));
        score += distanceScore * 0.3;
        
        // 時間匹配度
        const estimatedStayTime = calculateStayTime(place.type);
        const timeMatch = Math.min(100, (availableTime / estimatedStayTime) * 100);
        score += timeMatch * 0.25;
        reasons.push(`時間匹配度: ${Math.round(timeMatch)}%`);
        
        // 營業狀態檢查
        if (place.isOpenNow) {
            score += 80 * 0.2;
            reasons.push('當前營業中');
        }
        
        // 用戶偏好匹配
        const preferenceMatch = calculatePreferenceMatch(place, userPreferences);
        score += preferenceMatch * 0.15;
        reasons.push(`偏好匹配: ${Math.round(preferenceMatch)}%`);
        
        // 評價質量
        score += (place.rating * 20) * 0.1; // 5星 = 100分
        
        // 檢查是否影響後續行程
        const conflicts = await checkScheduleConflicts(place, availableTime);
        if (!conflicts.hasSeriousConflict) {
            recommendations.push({
                place,
                score: Math.round(score),
                estimatedStayTime,
                distance: place.distance,
                reasons,
                travelTime: calculateTravelTime(currentLocation, place.location),
                totalTime: calculateTravelTime(currentLocation, place.location) + estimatedStayTime
            });
        }
    }
    
    // 3. 排序和返回
    return recommendations
        .sort((a, b) => b.score - a.score)
        .slice(0, 5); // 返回前5個推薦
}

// 計算停留時間（根據類型）
function calculateStayTime(placeType) {
    const stayTimes = {
        'cafe': 30,        // 30分鐘
        'restaurant': 45,  // 45分鐘
        'park': 25,        // 25分鐘
        'museum': 60,      // 60分鐘
        'store': 20,       // 20分鐘
        'viewpoint': 15    // 15分鐘
    };
    return stayTimes[placeType] || 30;
}
    </div>
    
    <h4>⚙️ 系統觸發時機</h4>
    <div style="background: #f7fafc; padding: 15px; border-radius: 6px; margin: 15px 0;">
        <strong>自動偵測觸發：</strong><br>
        • 行程實際結束時間比預定早30分鐘以上<br>
        • 移動到下個地點的時間縮短15分鐘以上<br>
        • 用戶手動標記「提前結束」或「取消行程」<br>
        • 系統檢測到連續空檔時間超過20分鐘<br><br>
        
        <strong>手動觸發：</strong><br>
        • 用戶點擊「尋找附近活動」按鈕<br>
        • 搖晃手機觸發隨機推薦<br>
        • 語音指令：「附近有什麼可以做的？」
    </div>
    
    <h4>🎯 實際應用案例</h4>
    <div style="background: #e6fffa; padding: 15px; border-radius: 6px; margin: 15px 0;">
        <strong>情境：台北101觀景台提前結束</strong><br><br>
        
        <strong>📅 原行程：</strong><br>
        14:00-15:30 台北101觀景台<br>
        16:00-18:00 國父紀念館<br><br>
        
        <strong>🔄 實際情況：</strong><br>
        14:50 提前結束觀景台參觀<br>
        空檔時間：14:50-16:00（70分鐘）<br>
        移動到國父紀念館需15分鐘<br>
        實際可用時間：55分鐘<br><br>
        
        <strong>🤖 系統推薦：</strong><br>
        1. <strong>信義誠品書店</strong> (步行5分鐘，建議35分鐘)<br>
        2. <strong>ATT 4 FUN商場</strong> (步行8分鐘，建議40分鐘)<br>
        3. <strong>象山親山步道入口</strong> (步行12分鐘，建議30分鐘)<br><br>
        
        <strong>✅ 用戶選擇：</strong><br>
        選擇信義誠品書店，系統自動插入行程：<br>
        14:50-15:25 信義誠品書店<br>
        15:25-15:40 移動到國父紀念館<br>
        16:00-18:00 國父紀念館（原行程不變）
    </div>
    
    <h4>📊 效能優化策略</h4>
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 15px 0;">
        <div style="background: #ebf8ff; padding: 15px; border-radius: 6px;">
            <strong>預載入機制</strong><br>
            • 行程開始前預先載入附近地點數據<br>
            • 建立地點緩存，減少API呼叫<br>
            • 預計算可能的路徑和時間
        </div>
        <div style="background: #e6fffa; padding: 15px; border-radius: 6px;">
            <strong>智能過濾</strong><br>
            • 根據歷史選擇學習用戶偏好<br>
            • 避開曾經跳過的地點類型<br>
            • 優先推薦高評價、高人氣地點
        </div>
        <div style="background: #fefcbf; padding: 15px; border-radius: 6px;">
            <strong>分層推薦</strong><br>
            • 第一層：步行5分鐘內<br>
            • 第二層：步行10分鐘內<br>
            • 第三層：交通工具5分鐘內
        </div>
        <div style="background: #fed7d7; padding: 15px; border-radius: 6px;">
            <strong>離線支援</strong><br>
            • 下載常用地點資訊<br>
            • 離線計算和推薦<br>
            • 重新連線後同步
        </div>
    </div>
    
    <div class="info-box">
        <strong>✨ 功能亮點：</strong> 
        <ul>
            <li><strong>善用零碎時間：</strong> 將原本浪費的空檔轉化為有價值的體驗</li>
            <li><strong>無縫整合：</strong> 不破壞原行程結構，僅作「補位」而非重排</li>
            <li><strong>智能匹配：</strong> 考慮距離、時間、偏好等多重因素</li>
            <li><strong>用戶友好：</strong> 非強制性推薦，一鍵加入或略過</li>
            <li><strong>即時有效：</strong> 基於當前位置和狀態的即時推薦</li>
            <li><strong>學習優化：</strong> 根據用戶選擇行為不斷改進推薦準確度</li>
        </ul>
    </div>
</div>

    <h2 id="section-5-2">💰 多人協作與預算管理</h2>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">👥</div>
            <div class="function-title">團體旅遊痛點解決方案</div>
        </div>
        
        <h4>🎯 解決痛點</h4>
        <ul>
            <li>多人出遊時預算難以統計</li>
            <li>景點選擇意見不合</li>
            <li>費用分攤計算麻煩</li>
            <li>團體容易走散</li>
        </ul>
        
        <h4>🔧 功能設計</h4>
        <table>
            <tr>
                <th style="width: 30%;">功能</th>
                <th style="width: 35%;">操作方式</th>
                <th style="width: 35%;">技術實現</th>
            </tr>
            <tr>
                <td><strong>分帳預算備註</strong></td>
                <td>• 每個行程點標註「預估人均消費」<br>• 自動計算總開支<br>• 生成費用分攤報表</td>
                <td>• 數字輸入組件<br>• 自動計算引擎<br>• PDF報表生成</td>
            </tr>
            <tr>
                <td><strong>投票決策系統</strong></td>
                <td>• 針對爭議行程發起投票<br>• 設定投票時限<br>• 即時顯示投票結果</td>
                <td>• 實時投票系統<br>• WebSocket同步<br>• 結果視覺化</td>
            </tr>
            <tr>
                <td><strong>防走散模式</strong></td>
                <td>• 開啟暫時性位置共享<br>• 地圖顯示所有成員位置<br>• 設定集合點提醒</td>
                <td>• GPS位置追蹤<br>• 地圖標記系統<br>• 推播通知提醒</td>
            </tr>
            <tr>
                <td><strong>費用分攤計算</strong></td>
                <td>• 自動計算每人應付金額<br>• 支援多種分攤方式<br>• 生成結算連結</td>
                <td>• 數學計算引擎<br>• 支付API整合<br>• 結算系統</td>
            </tr>
        </table>
        
        <h4>📊 預算管理流程</h4>
        <div style="background: #f7fafc; padding: 15px; border-radius: 6px; margin: 15px 0; text-align: center;">
            <strong>1. 設定總預算</strong> → <strong>2. 分配各項目預算</strong> → <strong>3. 實際消費記錄</strong><br>
            → <strong>4. 自動計算剩餘</strong> → <strong>5. 超支預警</strong> → <strong>6. 最終結算報表</strong>
        </div>
        
        <div class="info-box">
            <strong>✨ 功能亮點：</strong> 
            <ul>
                <li>解決團體旅遊最常見的「金錢統計」與「意見不合」痛點</li>
                <li>自動化計算減少人工錯誤</li>
                <li>即時協作提升決策效率</li>
                <li>確保團體安全和凝聚力</li>
            </ul>
        </div>
    </div>

    <div class="page-break"></div>

    <h2 id="section-5-3">🚶 交通銜接與步行優化</h2>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">🚉</div>
            <div class="function-title">人性化交通體驗設計</div>
        </div>
        
        <h4>🎯 使用情境</h4>
        <p>避免交通轉乘過於緊湊導致壓力過大，優化「體感轉乘」體驗。</p>
        
        <h4>🔧 細節設計</h4>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 15px 0;">
            <div style="background: #e6fffa; padding: 15px; border-radius: 6px;">
                <strong>轉乘寬限時間</strong><br>
                • 演算法自動在不同交通工具間預留10-15分鐘緩衝<br>
                • 考慮「尋找月台時間」、「購票排隊時間」<br>
                • 避免過於緊湊的轉乘安排
            </div>
            <div style="background: #ebf8ff; padding: 15px; border-radius: 6px;">
                <strong>步行負重警示</strong><br>
                • 若連續步行超過1.5公里，系統自動標示<br>
                • 提供「建議叫車」按鈕<br>
                • 一鍵跳轉Uber/LINE TAXI
            </div>
            <div style="background: #fefcbf; padding: 15px; border-radius: 6px;">
                <strong>精準乘車資訊</strong><br>
                • 行程提醒直接顯示「第幾月台」<br>
                • 提供「靠近哪部電梯」資訊<br>
                • 減少在車站慌亂的時間
            </div>
            <div style="background: #fed7d7; padding: 15px; border-radius: 6px;">
                <strong>無障礙路線規劃</strong><br>
                • 為有需要的用戶規劃無障礙路線<br>
                • 標示電梯、斜坡位置<br>
                • 避開樓梯和障礙物
            </div>
        </div>
        
        <h4>📱 用戶體驗流程</h4>
        <div style="background: #f7fafc; padding: 15px; border-radius: 6px; margin: 15px 0;">
            <div style="display: flex; align-items: center; margin: 10px 0;">
                <div style="width: 30px; height: 30px; background: #4299e1; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 10px;">1</div>
                <div>用戶查看下一段行程</div>
            </div>
            <div style="display: flex; align-items: center; margin: 10px 0;">
                <div style="width: 30px; height: 30px; background: #4299e1; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 10px;">2</div>
                <div>系統顯示詳細交通資訊（月台、車次、步行路線）</div>
            </div>
            <div style="display: flex; align-items: center; margin: 10px 0;">
                <div style="width: 30px; height: 30px; background: #4299e1; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 10px;">3</div>
                <div>提供緩衝時間建議和替代方案</div>
            </div>
            <div style="display: flex; align-items: center; margin: 10px 0;">
                <div style="width: 30px; height: 30px; background: #4299e1; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 10px;">4</div>
                <div>一鍵導航到正確的上車位置</div>
            </div>
        </div>
        
        <h4>🗺️ 實際應用範例</h4>
        <div style="background: #fff5f5; padding: 15px; border-radius: 6px; margin: 15px 0;">
            <strong>情境：</strong> 從台北車站轉乘到淡水<br>
            <strong>系統顯示：</strong> <br>
            • 🚉 請到第4月台搭乘往淡水的列車<br>
            • 🎯 建議從西3出口進入，最近電梯在左側<br>
            • ⏰ 下一班車15:20發車，建議15:05前到達月台<br>
            • 🚶 從當前位置步行到月台約需8分鐘<br>
            • 📱 點擊「開始導航」引導到正確月台
        </div>
        
        <div class="info-box">
            <strong>✨ 功能亮點：</strong> 
            <ul>
                <li>優化「體感轉乘」體驗，減少旅行壓力</li>
                <li>提供精準實用的交通資訊</li>
                <li>考慮不同用戶的特殊需求</li>
                <li>讓行程規劃更符合人性化需求</li>
            </ul>
        </div>
    </div>

    <div class="page-break"></div>

    <h1 id="section-6">六、技術架構與開發指南</h1>
    
    <div class="highlight-box">
        <h2>💻 技術實現方案</h2>
        <p>針對「1 Mac + 4 Windows」團隊的技術選型和開發策略，確保團隊高效協作。</p>
    </div>

    <h2 id="section-6-1">🛠️ 技術棧選擇</h2>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">⚙️</div>
            <div class="function-title">跨平台技術架構</div>
        </div>
        
        <h4>📱 前端APP技術選型</h4>
        <table>
            <tr>
                <th style="width: 30%;">方案</th>
                <th style="width: 35%;">優點</th>
                <th style="width: 35%;">缺點</th>
            </tr>
            <tr>
                <td><strong>Flutter (推薦)</strong></td>
                <td>• 真正的跨平台，一套代碼兩個平台<br>• 性能接近原生<br>• Google強力支持</td>
                <td>• 學習曲線較陡<br>• 生態系統較新</td>
            </tr>
            <tr>
                <td><strong>React Native</strong></td>
                <td>• JavaScript生態豐富<br>• 社群活躍<br>• 學習資源多</td>
                <td>• 性能稍差<br>• 原生模組依賴多</td>
            </tr>
            <tr>
                <td><strong>原生開發</strong><br>(Swift + Kotlin)</td>
                <td>• 最佳性能<br>• 完整平台功能<br>• 最佳用戶體驗</td>
                <td>• 需要兩套代碼<br>• 開發成本高<br>• <strong>不適合團隊配置</strong></td>
            </tr>
        </table>
        
        <div class="warning-box">
            <strong>⚠️ 重要提醒：</strong> 絕對不能選擇原生開發（Swift/Kotlin），否則1 Mac + 4 Windows的團隊會分裂成兩個團隊，協作效率極低。
        </div>
        
        <h4>🔧 完整技術棧建議</h4>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 15px 0;">
            <div style="background: #e6fffa; padding: 15px; border-radius: 6px;">
                <strong>前端APP (Flutter)</strong><br>
                • 框架：Flutter 3.x<br>
                • 狀態管理：Riverpod 或 Bloc<br>
                • 地圖：Google Maps Flutter<br>
                • 本地存儲：Hive 或 SQLite<br>
                • 網路：Dio 或 http
            </div>
            <div style="background: #ebf8ff; padding: 15px; border-radius: 6px;">
                <strong>後端API</strong><br>
                • 語言：Node.js + Express 或 Python + FastAPI<br>
                • 身份驗證：JWT + OAuth2<br>
                • 即時通訊：Socket.io 或 Firebase<br>
                • 文件存儲：AWS S3 或 Firebase Storage
            </div>
            <div style="background: #fefcbf; padding: 15px; border-radius: 6px;">
                <strong>資料庫</strong><br>
                • 主資料庫：PostgreSQL (用戶、行程數據)<br>
                • 緩存：Redis (會話、即時數據)<br>
                • 文件數據：MongoDB (日誌、分析數據)<br>
                • 搜索：Elasticsearch (地點搜索)
            </div>
            <div style="background: #fed7d7; padding: 15px; border-radius: 6px;">
                <strong>AI/ML服務</strong><br>
                • 語言：Python<br>
                • 框架：TensorFlow / PyTorch<br>
                • NLP：spaCy + transformers<br>
                • 部署：FastAPI + Docker
            </div>
        </div>
        
        <h4>☁️ 雲端服務整合</h4>
        <div style="background: #f7fafc; padding: 15px; border-radius: 6px; margin: 15px 0;">
            <strong>地圖服務：</strong> Google Maps Platform (Places, Directions, Geocoding API)<br>
            <strong>AI服務：</strong> OpenAI GPT API 或 Google Gemini API<br>
            <strong>推播通知：</strong> Firebase Cloud Messaging (FCM)<br>
            <strong>文件存儲：</strong> AWS S3 或 Google Cloud Storage<br>
            <strong>監控分析：</strong> Sentry (錯誤追蹤) + Google Analytics
        </div>
    </div>

    <h2 id="section-6-2">👥 團隊分工建議（1 Mac + 4 Windows）</h2>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">👨‍💻</div>
            <div class="function-title">基於作業系統的優化分工</div>
        </div>
        
        <table>
            <tr>
                <th style="width: 20%;">角色</th>
                <th style="width: 20%;">建議系統</th>
                <th style="width: 30%;">主要職責</th>
                <th style="width: 30%;">特殊任務</th>
            </tr>
            <tr>
                <td><strong>App 前端主程 (你)</strong></td>
                <td><span style="color: #38a169;">Mac</span></td>
                <td>• Flutter架構設計<br>• iOS版本編譯<br>• 跨平台適配</td>
                <td>• iOS上架管理<br>• UI細節修復<br>• 發布經理</td>
            </tr>
            <tr>
                <td><strong>App 前端副手</strong></td>
                <td><span style="color: #3182ce;">Windows</span></td>
                <td>• Android版本開發<br>• 功能模組實作<br>• Android測試</td>
                <td>• Android模擬器測試<br>• Google Play上架<br>• 跨平台問題排查</td>
            </tr>
            <tr>
                <td><strong>AI/演算法工程師</strong></td>
                <td><span style="color: #3182ce;">Windows + WSL2</span></td>
                <td>• 路徑演算法開發<br>• NLP情感分析<br>• 機器學習模型</td>
                <td>• GPU加速訓練<br>• 模型優化部署<br>• AI API開發</td>
            </tr>
            <tr>
                <td><strong>後端工程師</strong></td>
                <td><span style="color: #3182ce;">Windows + Docker</span></td>
                <td>• API設計開發<br>• 資料庫設計<br>• 伺服器部署</td>
                <td>• Docker環境搭建<br>• 效能優化<br>• 安全性設計</td>
            </tr>
            <tr>
                <td><strong>PM / UI/UX設計</strong></td>
                <td><span style="color: #3182ce;">Windows</span></td>
                <td>• 產品規劃<br>• UI/UX設計<br>• 用戶測試</td>
                <td>• Figma原型設計<br>• 用戶反饋收集<br>• 專案進度管理</td>
            </tr>
        </table>
        
        <h4>🎯 你的特殊任務（The Mac User）</h4>
        <div class="step-container">
            <div class="step"><strong>Release Manager：</strong> 負責iOS版本打包、上架、更新，每次demo前確保iPhone版本正常運行</div>
            <div class="step"><strong>UI細節修復師：</strong> 調整iOS專屬UI問題（動態島、瀏海、手勢操作）</div>
            <div class="step"><strong>終端機導師：</strong> 協助Windows成員設定WSL2，統一開發環境</div>
            <div class="step"><strong>跨平台測試：</strong> 確保iOS和Android版本功能一致，體驗相似</div>
        </div>
        
        <div class="info-box">
            <strong>💡 工作流程建議：</strong> 
            <ul>
                <li>Windows成員專注開發功能模組，用Android模擬器測試</li>
                <li>你定期拉取最新代碼，在Mac上編譯iOS版本進行測試</li>
                <li>使用Git分支管理，確保代碼同步和版本控制</li>
                <li>每週進行一次跨平台整合測試</li>
            </ul>
        </div>
    </div>

    <div class="page-break"></div>

    <h2 id="section-6-3">🔧 跨平台協作解決方案</h2>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">🔄</div>
            <div class="function-title">解決Windows與Mac的水土不服</div>
        </div>
        
        <h4>⚠️ 三大協作問題與解決方案</h4>
        
        <div style="background: #fff5f5; padding: 15px; border-radius: 6px; margin: 15px 0;">
            <strong>問題1：換行符號的地獄 (Line Endings)</strong><br>
            • Windows按Enter是CRLF (\r\n)，Mac是LF (\n)<br>
            • Git會以為每一行都改過了，導致衝突爆炸<br><br>
            
            <strong>✅ 解決方案：</strong><br>
            在專案根目錄創建 <code>.gitattributes</code> 檔案：
            <div class="code-block">
# 強制統一換行符號
* text=auto eol=lf

# 確保這些文件保持LF格式
*.dart text eol=lf
*.js text eol=lf
*.ts text eol=lf
*.json text eol=lf
*.yml text eol=lf
*.yaml text eol=lf
            </div>
            或在Windows Git安裝時設定：<br>
            <code>git config --global core.autocrlf input</code>
        </div>
        
        <div style="background: #ebf8ff; padding: 15px; border-radius: 6px; margin: 15px 0;">
            <strong>問題2：路徑斜線的問題</strong><br>
            • Windows路徑用反斜線 <code>\</code>，Mac用正斜線 <code>/</code><br>
            • 寫死路徑會在不同系統報錯<br><br>
            
            <strong>✅ 解決方案：</strong><br>
            永遠使用程式庫的「路徑拼接功能」，不要手打斜線：
            <div class="code-block">
// Node.js範例 - 使用path.join()
const path = require('path');
const filePath = path.join('folder', 'subfolder', 'file.txt');

// Python範例 - 使用os.path.join()
import os
file_path = os.path.join('folder', 'subfolder', 'file.txt')

// Flutter/Dart範例 - 使用pkg:path
import 'package:path/path.dart' as p;
String filePath = p.join('folder', 'subfolder', 'file.txt');
            </div>
        </div>
        
        <div style="background: #e6fffa; padding: 15px; border-radius: 6px; margin: 15px 0;">
            <strong>問題3：環境一致性問題</strong><br>
            • Windows裝PostgreSQL很麻煩<br>
            • 版本可能跟Mac不一樣<br>
            • 依賴庫版本不一致<br><br>
            
            <strong>✅ 解決方案：使用Docker統一環境</strong><br>
            創建 <code>docker-compose.yml</code> 檔案：
            <div class="code-block">
version: '3.8'
services:
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_USER: travel_user
      POSTGRES_PASSWORD: travel_password
      POSTGRES_DB: travel_db
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

volumes:
  postgres_data:
            </div>
            Windows成員只需執行：<br>
            <code>docker-compose up -d</code><br>
            就會獲得跟你Mac一模一樣的開發環境！
        </div>
        
        <h4>📋 開發環境設定檢查清單</h4>
        <div style="background: #f7fafc; padding: 15px; border-radius: 6px; margin: 15px 0;">
            <input type="checkbox" checked> 所有成員安裝相同版本的Flutter (3.16+)<br>
            <input type="checkbox" checked> 設定 <code>.gitattributes</code> 統一換行符號<br>
            <input type="checkbox" checked> 安裝Docker Desktop (Windows/Mac)<br>
            <input type="checkbox" checked> Windows成員安裝WSL2 (AI/後端工程師)<br>
            <input type="checkbox" checked> 統一編輯器設定 (VS Code推薦)<br>
            <input type="checkbox" checked> 設定pre-commit hooks檢查代碼風格<br>
            <input type="checkbox" checked> 建立共享的開發文檔和API文件
        </div>
        
        <div class="info-box">
            <strong>💡 最佳實踐建議：</strong> 
            <ul>
                <li>使用VS Code Remote - WSL擴展，讓Windows開發體驗接近Mac</li>
                <li>建立標準化的開發環境設定腳本</li>
                <li>使用GitHub Actions進行自動化測試和建置</li>
                <li>定期進行代碼審查和協作訓練</li>
            </ul>
        </div>
    </div>

    <div class="page-break"></div>

    <h1 id="section-7">七、開發時程與優先級</h1>
    
    <div class="highlight-box">
        <h2>📅 分階段開發策略</h2>
        <p>採用MVP思維，先推出核心功能驗證市場，再逐步添加進階功能。</p>
    </div>

    <h2 id="section-7-1">🟢 第一階段：MVP版本（核心體驗）</h2>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">🚀</div>
            <div class="function-title">最小可行產品 - 8週開發期</div>
        </div>
        
        <h4>🎯 MVP目標</h4>
        <p>驗證核心概念，提供基本的行程管理功能，收集用戶反饋。</p>
        
        <h4>📋 MVP功能清單</h4>
        <table>
            <tr>
                <th style="width: 20%;">功能模組</th>
                <th style="width: 40%;">核心功能</th>
                <th style="width: 20%;">開發難度</th>
                <th style="width: 20%;">優先級</th>
            </tr>
            <tr>
                <td><strong>使用者系統</strong></td>
                <td>• 註冊/登入（Email+密碼）<br>• 基本個人資料設定<br>• 偏好設定（簡化版）</td>
                <td>⭐☆☆☆☆</td>
                <td><span class="badge badge-mvp">P0</span></td>
            </tr>
            <tr>
                <td><strong>行程管理</strong></td>
                <td>• 基本CRUD操作<br>• 日曆檢視模式<br>• 地點搜索（基礎）</td>
                <td>⭐⭐☆☆☆</td>
                <td><span class="badge badge-mvp">P0</span></td>
            </tr>
            <tr>
                <td><strong>地圖整合</strong></td>
                <td>• Google Maps基本整合<br>• 地點標記顯示<br>• 外部導航連結</td>
                <td>⭐⭐☆☆☆</td>
                <td><span class="badge badge-mvp">P0</span></td>
            </tr>
            <tr>
                <td><strong>路徑優化</strong></td>
                <td>• 基礎TSP演算法<br>• 簡單的路徑排序<br>• 交通時間估算</td>
                <td>⭐⭐⭐☆☆</td>
                <td><span class="badge badge-mvp">P0</span></td>
            </tr>
            <tr>
                <td><strong>分享協作</strong></td>
                <td>• 生成分享連結<br>• 多人檢視行程<br>• 基礎權限管理</td>
                <td>⭐⭐☆☆☆</td>
                <td><span class="badge badge-mvp">P0</span></td>
            </tr>
        </table>
        
        <h4>⏳ MVP開發時程（8週）</h4>
        <div style="background: #f7fafc; padding: 15px; border-radius: 6px; margin: 15px 0;">
            <strong>第1-2週：</strong> 專案初始化、技術架構搭建、開發環境設定<br>
            <strong>第3-4週：</strong> 使用者系統、基本行程CRUD、資料庫設計<br>
            <strong>第5-6週：</strong> 地圖整合、地點搜索、路徑演算法基礎版<br>
            <strong>第7週：</strong> 分享協作功能、UI/UX優化<br>
            <strong>第8週：</strong> 測試、除錯、準備上架
        </div>
        
        <h4>🎯 MVP成功指標</h4>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 15px 0;">
            <div style="background: #e6fffa; padding: 10px; border-radius: 6px; text-align: center;">
                <strong>用戶獲取</strong><br>
                100位種子用戶<br>
                50%註冊轉化率
            </div>
            <div style="background: #ebf8ff; padding: 10px; border-radius: 6px; text-align: center;">
                <strong>使用指標</strong><br>
                40%用戶每週使用<br>
                平均創建3個行程
            </div>
            <div style="background: #fefcbf; padding: 10px; border-radius: 6px; text-align: center;">
                <strong>滿意度</strong><br>
                4.0+ App Store評分<br>
                70%用戶願意推薦
            </div>
        </div>
    </div>

    <h2 id="section-7-2">🟡 第二階段：智慧升級（12週）</h2>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">🧠</div>
            <div class="function-title">AI與智能功能擴展</div>
        </div>
        
        <h4>🎯 階段目標</h4>
        <p>添加AI驅動的智能功能，提升產品差異化和用戶體驗。</p>
        
        <h4>📋 第二階段功能</h4>
        <table>
            <tr>
                <th style="width: 20%;">功能類別</th>
                <th style="width: 40%;">新增功能</th>
                <th style="width: 20%;">開發難度</th>
                <th style="width: 20%;">優先級</th>
            </tr>
            <tr>
                <td><strong>AI助手</strong></td>
                <td>• LLM行程助手（文字介紹）<br>• 語音導覽功能<br>• 智能問答系統</td>
                <td>⭐⭐⭐⭐☆</td>
                <td><span class="badge badge-phase2">P1</span></td>
            </tr>
            <tr>
                <td><strong>風險預警</strong></td>
                <td>• 不踩雷系統（基礎版）<br>• 天氣備用方案<br>• 即時事件提醒</td>
                <td>⭐⭐⭐☆☆</td>
                <td><span class="badge badge-phase2">P1</span></td>
            </tr>
            <tr>
                <td><strong>進階協作</strong></td>
                <td>• 多人即時編輯<br>• 投票決策系統<br>• 預算分攤計算</td>
                <td>⭐⭐⭐☆☆</td>
                <td><span class="badge badge-phase2">P1</span></td>
            </tr>
            <tr>
                <td><strong>智慧行李</strong></td>
                <td>• 基礎行李清單生成<br>• 天氣關聯建議<br>• 活動類型偵測</td>
                <td>⭐⭐☆☆☆</td>
                <td><span class="badge badge-phase2">P2</span></td>
            </tr>
            <tr>
                <td><strong>離線功能</strong></td>
                <td>• 行程離線瀏覽<br>• 地圖離線下載<br>• 資料同步機制</td>
                <td>⭐⭐☆☆☆</td>
                <td><span class="badge badge-phase2">P1</span></td>
            </tr>
        </table>
        
        <h4>⏳ 開發時程規劃</h4>
        <div style="background: #f7fafc; padding: 15px; border-radius: 6px; margin: 15px 0;">
            <strong>第1-3週：</strong> AI助手功能開發（LLM整合、語音導覽）<br>
            <strong>第4-6週：</strong> 風險預警系統（情感分析、天氣API）<br>
            <strong>第7-9週：</strong> 進階協作功能（即時編輯、投票系統）<br>
            <strong>第10-12週：</strong> 智慧行李清單、離線功能、系統優化
        </div>
    </div>

    <div class="page-break"></div>

    <h2 id="section-7-3">🔴 第三階段：創新體驗（16週）</h2>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">🎮</div>
            <div class="function-title">遊戲化與創新功能</div>
        </div>
        
        <h4>🎯 階段目標</h4>
        <p>建立產品獨特性和競爭壁壘，提供市場上沒有的創新體驗。</p>
        
        <h4>📋 第三階段功能</h4>
        <table>
            <tr>
                <th style="width: 20%;">功能類別</th>
                <th style="width: 40%;">創新功能</th>
                <th style="width: 20%;">開發難度</th>
                <th style="width: 20%;">優先級</th>
            </tr>
            <tr>
                <td><strong>盲盒體驗</strong></td>
                <td>• 完整盲盒旅行系統<br>• 偏好問卷設計<br>• 不可修改機制</td>
                <td>⭐⭐⭐☆☆</td>
                <td><span class="badge badge-phase3">P3</span></td>
            </tr>
            <tr>
                <td><strong>隨機探索</strong></td>
                <td>• 擲骰子決策工具<br>• 即時位置推薦<br>• 遊戲化界面設計</td>
                <td>⭐⭐☆☆☆</td>
                <td><span class="badge badge-phase3">P3</span></td>
            </tr>
            <tr>
                <td><strong>視覺化</strong></td>
                <td>• 行程預告片生成<br>• AI文案與剪輯<br>• 社群分享優化</td>
                <td>⭐⭐⭐⭐☆</td>
                <td><span class="badge badge-phase3">P4</span></td>
            </tr>
            <tr>
                <td><strong>成就系統</strong></td>
                <td>• 旅遊足跡地圖<br>• 效率回饋報告<br>• 成就徽章系統</td>
                <td>⭐⭐⭐☆☆</td>
                <td><span class="badge badge-phase3">P3</span></td>
            </tr>
            <tr>
                <td><strong>行為學習</strong></td>
                <td>• 後悔率標記系統<br>• 個性化推薦優化<br>• 智能行程補位</td>
                <td>⭐⭐⭐⭐☆</td>
                <td><span class="badge badge-phase3">P2</span></td>
            </tr>
        </table>
        
        <h4>⏳ 開發時程規劃</h4>
        <div style="background: #f7fafc; padding: 15px; border-radius: 6px; margin: 15px 0;">
            <strong>第1-4週：</strong> 盲盒旅行體驗完整開發<br>
            <strong>第5-8週：</strong> 隨機探索工具與遊戲化設計<br>
            <strong>第9-12週：</strong> 行程視覺化與預告片生成<br>
            <strong>第13-16週：</strong> 成就系統、行為學習、系統整合
        </div>
        
        <h4>📊 完整產品路線圖</h4>
        <div style="background: #f7fafc; padding: 15px; border-radius: 6px; margin: 15px 0; font-size: 10pt;">
            <div style="display: flex; align-items: center; margin: 5px 0;">
                <div style="width: 100px; color: #38a169;">🟢 MVP階段</div>
                <div style="flex: 1; background: #38a169; height: 8px; border-radius: 4px;"></div>
                <div style="width: 60px; text-align: right;">8週</div>
            </div>
            <div style="display: flex; align-items: center; margin: 5px 0;">
                <div style="width: 100px; color: #d69e2e;">🟡 智慧升級</div>
                <div style="flex: 1; background: #d69e2e; height: 8px; border-radius: 4px;"></div>
                <div style="width: 60px; text-align: right;">12週</div>
            </div>
            <div style="display: flex; align-items: center; margin: 5px 0;">
                <div style="width: 100px; color: #e53e3e;">🔴 創新體驗</div>
                <div style="flex: 1; background: #e53e3e; height: 8px; border-radius: 4px;"></div>
                <div style="width: 60px; text-align: right;">16週</div>
            </div>
            <div style="display: flex; align-items: center; margin: 5px 0;">
                <div style="width: 100px; color: #718096;">總計</div>
                <div style="flex: 1; background: #718096; height: 8px; border-radius: 4px;"></div>
                <div style="width: 60px; text-align: right;">36週</div>
            </div>
        </div>
        
        <div class="info-box">
            <strong>💡 開發策略建議：</strong> 
            <ul>
                <li>每個階段完成後都進行用戶測試和反饋收集</li>
                <li>優先開發對用戶最有價值的核心功能</li>
                <li>保持技術架構的靈活性，便於後續擴展</li>
                <li>建立自動化測試和部署流程，提升開發效率</li>
            </ul>
        </div>
    </div>

    <div class="page-break"></div>

    <h1 id="section-8">八、技術實現示例</h1>
    
    <div class="highlight-box">
        <h2>💻 核心功能技術實現</h2>
        <p>提供關鍵功能的技術實現示例，幫助開發團隊快速上手。</p>
    </div>

    <h2 id="section-8-1">🗑️ 自動刪除過期行程功能</h2>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">⏰</div>
            <div class="function-title">後端定期任務實現</div>
        </div>
        
        <h4>🎯 功能需求</h4>
        <ul>
            <li>自動檢查並刪除過期的行程</li>
            <li>避免資料庫累積無用數據</li>
            <li>減少手動清理的工作</li>
        </ul>
        
        <h4>🔧 技術方案選擇</h4>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 15px 0;">
            <div style="background: #e6fffa; padding: 15px; border-radius: 6px;">
                <strong>方案A：Node.js + node-cron</strong><br>
                • 適合JavaScript技術棧<br>
                • 與現有Node.js後端整合容易<br>
                • 部署簡單
            </div>
            <div style="background: #ebf8ff; padding: 15px; border-radius: 6px;">
                <strong>方案B：Python + Celery</strong><br>
                • 適合Python後端<br>
                • 分散式任務處理能力強<br>
                • 支援複雜的調度需求
            </div>
        </div>
        
        <h4>💻 Node.js實現示例</h4>
        <div class="code-block">
// backend/src/jobs/cleanupJobs.js
const cron = require('node-cron');
const { Event } = require('../models/event');
const logger = require('../utils/logger');

/**
 * 刪除過期行程的函數
 * 每天午夜00:00執行
 */
async function deleteExpiredEvents() {
    try {
        const currentTime = new Date();
        
        // 查找所有結束時間早於當前時間的行程
        const expiredEvents = await Event.find({
            end_date: { $lt: currentTime },
            is_deleted: false  // 只處理未標記為刪除的行程
        });
        
        if (expiredEvents.length === 0) {
            logger.info('沒有找到過期行程');
            return;
        }
        
        // 軟刪除：標記為已刪除，而不是物理刪除
        const eventIds = expiredEvents.map(event => event._id);
        await Event.updateMany(
            { _id: { $in: eventIds } },
            { 
                is_deleted: true,
                deleted_at: currentTime,
                deletion_reason: 'auto_expired'
            }
        );
        
        logger.info(`已標記 ${expiredEvents.length} 個過期行程為已刪除`);
        
        // 可選：發送通知給受影響的用戶
        await notifyUsersAboutExpiredEvents(expiredEvents);
        
    } catch (error) {
        logger.error('刪除過期行程時發生錯誤:', error);
        // 可以添加重試機制或錯誤通知
    }
}

/**
 * 通知用戶行程已過期（可選功能）
 */
async function notifyUsersAboutExpiredEvents(events) {
    // 按用戶分組行程
    const userEventsMap = {};
    events.forEach(event => {
        if (!userEventsMap[event.user_id]) {
            userEventsMap[event.user_id] = [];
        }
        userEventsMap[event.user_id].push(event);
    });
    
    // 為每個用戶發送通知
    for (const [userId, userEvents] of Object.entries(userEventsMap)) {
        try {
            // 發送推播通知
            await sendPushNotification(userId, {
                title: '行程已過期',
                body: `您有 ${userEvents.length} 個行程已過期並被自動清理`,
                data: {
                    type: 'events_expired',
                    count: userEvents.length,
                    event_ids: userEvents.map(e => e._id)
                }
            });
            
            // 可選：發送Email通知
            if (userEvents.length > 5) { // 只有過期行程較多時發送Email
                await sendEmailNotification(userId, userEvents);
            }
            
        } catch (error) {
            logger.error(`通知用戶 ${userId} 時發生錯誤:`, error);
        }
    }
}

/**
 * 設定定時任務
 * 每天午夜00:00執行
 */
function scheduleCleanupJobs() {
    // 使用cron表達式: 秒 分 時 日 月 星期
    // '0 0 * * *' 表示每天00:00執行
    cron.schedule('0 0 * * *', deleteExpiredEvents, {
        scheduled: true,
        timezone: "Asia/Taipei"  // 設定時區為台北時間
    });
    
    logger.info('已設定過期行程清理任務，每天00:00執行');
    
    // 開發環境：可以每小時執行一次以便測試
    if (process.env.NODE_ENV === 'development') {
        cron.schedule('0 * * * *', deleteExpiredEvents, {
            scheduled: true,
            timezone: "Asia/Taipei"
        });
        logger.info('開發環境：已設定每小時執行一次的測試清理任務');
    }
}

module.exports = {
    deleteExpiredEvents,
    scheduleCleanupJobs
};
        </div>
        
        <h4>📁 資料庫模型設計</h4>
        <div class="code-block">
// backend/src/models/event.js
const mongoose = require('mongoose');

const EventSchema = new mongoose.Schema({
    // 基本資訊
    title: {
        type: String,
        required: [true, '請輸入行程標題'],
        trim: true,
        maxlength: [100, '標題不能超過100個字元']
    },
    
    description: {
        type: String,
        maxlength: [500, '描述不能超過500個字元']
    },
    
    // 時間資訊
    start_date: {
        type: Date,
        required: [true, '請輸入開始時間']
    },
    
    end_date: {
        type: Date,
        required: [true, '請輸入結束時間'],
        validate: {
            validator: function(value) {
                return value > this.start_date;
            },
            message: '結束時間必須晚於開始時間'
        }
    },
    
    // 地點資訊
    location: {
        name: String,
        address: String,
        coordinates: {
            lat: Number,
            lng: Number
        },
        place_id: String  // Google Places ID
    },
    
    // 用戶關聯
    user_id: {
        type: mongoose.Schema.Types.ObjectId,
        ref: 'User',
        required: true,
        index: true  // 建立索引提升查詢效能
    },
    
    // 刪除相關欄位（軟刪除）
    is_deleted: {
        type: Boolean,
        default: false,
        index: true
    },
    
    deleted_at: Date,
    
    deletion_reason: {
        type: String,
        enum: ['user_deleted', 'auto_expired', 'system_cleanup', null]
    },
    
    // 時間戳
    created_at: {
        type: Date,
        default: Date.now
    },
    
    updated_at: {
        type: Date,
        default: Date.now
    }
    
}, {
    // 自動更新updated_at
    timestamps: { 
        createdAt: 'created_at',
        updatedAt: 'updated_at'
    },
    
    // 建立複合索引提升查詢效能
    indexes: [
        { user_id: 1, is_deleted: 1, end_date: 1 },  // 常用查詢條件
        { end_date: 1, is_deleted: 1 }  // 清理任務使用
    ]
});

// 更新前的middleware
EventSchema.pre('save', function(next) {
    this.updated_at = Date.now();
    next();
});

// 查詢middleware：自動過濾已刪除的行程
EventSchema.pre(/^find/, function(next) {
    if (this.getFilter().is_deleted === undefined) {
        this.where({ is_deleted: false });
    }
    next();
});

const Event = mongoose.model('Event', EventSchema);
module.exports = Event;
        </div>
        
        <h4>🚀 部署與監控</h4>
        <div style="background: #f7fafc; padding: 15px; border-radius: 6px; margin: 15px 0;">
            <strong>部署注意事項：</strong><br>
            1. 確保伺服器時區設定正確<br>
            2. 設定適當的日誌記錄級別<br>
            3. 監控任務執行狀態和效能<br>
            4. 設定錯誤警報通知<br><br>
            
            <strong>監控指標：</strong><br>
            • 每次清理的行程數量<br>
            • 任務執行時間<br>
            • 成功/失敗次數<br>
            • 資料庫效能影響
        </div>
        
        <div class="info-box">
            <strong>💡 最佳實踐建議：</strong> 
            <ul>
                <li>使用軟刪除而不是物理刪除，保留資料恢復的可能性</li>
                <li>為大量數據的清理任務設定低峰時段執行</li>
                <li>添加適當的索引以提升查詢效能</li>
                <li>監控資料庫的效能影響，必要時分批處理</li>
            </ul>
        </div>
    </div>

    <div class="page-break"></div>

    <h2 id="section-8-2">📊 年度行程回顧功能</h2>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">📈</div>
            <div class="function-title">數據統計與可視化</div>
        </div>
        
        <h4>🎯 功能需求</h4>
        <ul>
            <li>讓用戶查看過去一年的旅遊足跡</li>
            <li>提供統計數據和視覺化圖表</li>
            <li>支援年份選擇和篩選</li>
        </ul>
        
        <h4>🔧 後端API設計</h4>
        <div class="code-block">
// backend/src/routes/analytics.js
const express = require('express');
const router = express.Router();
const { Event } = require('../models/event');
const auth = require('../middleware/auth');

/**
 * 取得年度行程統計
 * GET /api/analytics/yearly/:year
 */
router.get('/yearly/:year', auth, async (req, res) => {
    try {
        const { year } = req.params;
        const userId = req.user.id;
        
        // 驗證年份格式
        if (!/^\d{4}$/.test(year)) {
            return res.status(400).json({
                error: '年份格式錯誤，請使用YYYY格式'
            });
        }
        
        // 計算日期範圍
        const startDate = new Date(`${year}-01-01T00:00:00.000Z`);
        const endDate = new Date(`${year}-12-31T23:59:59.999Z`);
        
        // 驗證日期有效性
        if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
            return res.status(400).json({
                error: '無效的年份'
            });
        }
        
        // 查詢該年度的所有行程
        const events = await Event.find({
            user_id: userId,
            start_date: { $gte: startDate },
            end_date: { $lte: endDate },
            is_deleted: false
        }).sort({ start_date: 1 });  // 按時間排序
        
        // 如果沒有行程，返回空數據
        if (events.length === 0) {
            return res.json({
                year: parseInt(year),
                total_events: 0,
                monthly_stats: [],
                category_stats: {},
                travel_days: 0,
                most_visited_location: null,
                message: '該年度沒有行程記錄'
            });
        }
        
        // 計算月度統計
        const monthlyStats = calculateMonthlyStats(events);
        
        // 計算類別統計
        const categoryStats = calculateCategoryStats(events);
        
        // 計算旅遊天數
        const travelDays = calculateTravelDays(events);
        
        // 找出最常去的地點
        const mostVisitedLocation = findMostVisitedLocation(events);
        
        // 計算總花費（如果有記錄）
        const totalSpent = calculateTotalSpent(events);
        
        // 構建回應數據
        const analyticsData = {
            year: parseInt(year),
            total_events: events.length,
            monthly_stats: monthlyStats,
            category_stats: categoryStats,
            travel_days: travelDays,
            most_visited_location: mostVisitedLocation,
            total_spent: totalSpent,
            events: events.map(event => ({
                id: event._id,
                title: event.title,
                start_date: event.start_date,
                end_date: event.end_date,
                location: event.location,
                category: event.category
            }))
        };
        
        res.json(analyticsData);
        
    } catch (error) {
        console.error('取得年度統計時發生錯誤:', error);
        res.status(500).json({
            error: '取得年度統計時發生錯誤',
            details: process.env.NODE_ENV === 'development' ? error.message : undefined
        });
    }
});

/**
 * 計算月度統計
 */
function calculateMonthlyStats(events) {
    const monthlyStats = Array(12).fill(0).map((_, index) => ({
        month: index + 1,
        count: 0,
        days: 0
    }));
    
    events.forEach(event => {
        const monthIndex = event.start_date.getMonth(); // 0-11
        monthlyStats[monthIndex].count++;
        
        // 計算該行程的天數
        const startDate = new Date(event.start_date);
        const endDate = new Date(event.end_date);
        const daysDiff = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
        monthlyStats[monthIndex].days += daysDiff;
    });
    
    return monthlyStats;
}

/**
 * 計算類別統計
 */
function calculateCategoryStats(events) {
    const categoryStats = {};
    
    events.forEach(event => {
        const category = event.category || '未分類';
        if (!categoryStats[category]) {
            categoryStats[category] = {
                count: 0,
                total_days: 0
            };
        }
        categoryStats[category].count++;
        
        // 計算天數
        const startDate = new Date(event.start_date);
        const endDate = new Date(event.end_date);
        const daysDiff = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
        categoryStats[category].total_days += daysDiff;
    });
    
    return categoryStats;
}

/**
 * 計算總旅遊天數（去重）
 */
function calculateTravelDays(events) {
    const uniqueDays = new Set();
    
    events.forEach(event => {
        const startDate = new Date(event.start_date);
        const endDate = new Date(event.end_date);
        
        // 遍歷行程的每一天
        let currentDate = new Date(startDate);
        while (currentDate <= endDate) {
            const dateString = currentDate.toISOString().split('T')[0];
            uniqueDays.add(dateString);
            currentDate.setDate(currentDate.getDate() + 1);
        }
    });
    
    return uniqueDays.size;
}

/**
 * 找出最常去的地點
 */
function findMostVisitedLocation(events) {
    const locationCount = {};
    let maxCount = 0;
    let mostVisited = null;
    
    events.forEach(event => {
        if (event.location && event.location.name) {
            const locationName = event.location.name;
            locationCount[locationName] = (locationCount[locationName] || 0) + 1;
            
            if (locationCount[locationName] > maxCount) {
                maxCount = locationCount[locationName];
                mostVisited = {
                    name: locationName,
                    count: maxCount,
                    coordinates: event.location.coordinates
                };
            }
        }
    });
    
    return mostVisited;
}

/**
 * 計算總花費
 */
function calculateTotalSpent(events) {
    return events.reduce((total, event) => {
        return total + (event.estimated_cost || 0);
    }, 0);
}

module.exports = router;
        </div>
        
        <h4>📱 前端實現示例（React/Vue）</h4>
        <div class="code-block">
// frontend/src/components/YearlyAnalytics.jsx
import React, { useState, useEffect } from 'react';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';
import { useParams } from 'react-router-dom';
import './YearlyAnalytics.css';

const YearlyAnalytics = () => {
    const { year } = useParams();
    const [analyticsData, setAnalyticsData] = useState(null);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState(null);

    useEffect(() => {
        fetchYearlyAnalytics();
    }, [year]);

    const fetchYearlyAnalytics = async () => {
        try {
            setLoading(true);
            const token = localStorage.getItem('token');
            const response = await fetch(`/api/analytics/yearly/${year}`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            if (!response.ok) {
                throw new Error('取得數據失敗');
            }

            const data = await response.json();
            setAnalyticsData(data);
        } catch (err) {
            setError(err.message);
        } finally {
            setLoading(false);
        }
    };

    if (loading) {
        return (
            <div className="loading-container">
                <div className="spinner"></div>
                <p>正在加載 {year} 年的行程回顧...</p>
            </div>
        );
    }

    if (error) {
        return (
            <div className="error-container">
                <h3>加載失敗</h3>
                <p>{error}</p>
                <button onClick={fetchYearlyAnalytics}>重新加載</button>
            </div>
        );
    }

    if (!analyticsData || analyticsData.total_events === 0) {
        return (
            <div className="empty-container">
                <h2>{year} 年度行程回顧</h2>
                <p>該年度沒有行程記錄，開始規劃你的下一次旅行吧！</p>
            </div>
        );
    }

    // 準備圖表數據
    const monthlyChartData = analyticsData.monthly_stats.map(month => ({
        name: `${month.month}月`,
        行程數量: month.count,
        旅遊天數: month.days
    }));

    const categoryChartData = Object.entries(analyticsData.category_stats).map(([category, stats]) => ({
        name: category,
        行程數量: stats.count,
        旅遊天數: stats.total_days
    }));

    return (
        <div className="yearly-analytics-container">
            <header className="analytics-header">
                <h1>{year} 年度行程回顧</h1>
                <div className="summary-cards">
                    <div className="summary-card">
                        <h3>總行程數</h3>
                        <p className="number">{analyticsData.total_events}</p>
                    </div>
                    <div className="summary-card">
                        <h3>總旅遊天數</h3>
                        <p className="number">{analyticsData.travel_days}</p>
                    </div>
                    <div className="summary-card">
                        <h3>最常去的地點</h3>
                        <p className="location">
                            {analyticsData.most_visited_location?.name || '無'}
                            {analyticsData.most_visited_location && 
                                ` (${analyticsData.most_visited_location.count}次)`}
                        </p>
                    </div>
                </div>
            </header>

            <section className="charts-section">
                <div className="chart-container">
                    <h3>月度分佈</h3>
                    <ResponsiveContainer width="100%" height={300}>
                        <BarChart data={monthlyChartData}>
                            <CartesianGrid strokeDasharray="3 3" />
                            <XAxis dataKey="name" />
                            <YAxis />
                            <Tooltip />
                            <Legend />
                            <Bar dataKey="行程數量" fill="#8884d8" />
                            <Bar dataKey="旅遊天數" fill="#82ca9d" />
                        </BarChart>
                    </ResponsiveContainer>
                </div>

                <div className="chart-container">
                    <h3>類別分佈</h3>
                    <ResponsiveContainer width="100%" height={300}>
                        <BarChart data={categoryChartData}>
                            <CartesianGrid strokeDasharray="3 3" />
                            <XAxis dataKey="name" />
                            <YAxis />
                            <Tooltip />
                            <Legend />
                            <Bar dataKey="行程數量" fill="#ffc658" />
                            <Bar dataKey="旅遊天數" fill="#ff8042" />
                        </BarChart>
                    </ResponsiveContainer>
                </div>
            </section>

            <section className="events-list">
                <h3>所有行程 ({analyticsData.events.length}個)</h3>
                <div className="events-grid">
                    {analyticsData.events.map(event => (
                        <div key={event.id} className="event-card">
                            <h4>{event.title}</h4>
                            <p className="date">
                                {new Date(event.start_date).toLocaleDateString()} - 
                                {new Date(event.end_date).toLocaleDateString()}
                            </p>
                            {event.location && (
                                <p className="location">
                                    📍 {event.location.name}
                                </p>
                            )}
                            {event.category && (
                                <span className="category-tag">{event.category}</span>
                            )}
                        </div>
                    ))}
                </div>
            </section>

            <section className="export-section">
                <button className="export-btn">
                    📥 匯出年度報告 (PDF)
                </button>
                <button className="share-btn">
                    🔗 分享年度回顧
                </button>
            </section>
        </div>
    );
};

export default YearlyAnalytics;
        </div>
        
        <h4>🎨 CSS樣式示例</h4>
        <div class="code-block">
/* frontend/src/components/YearlyAnalytics.css */
.yearly-analytics-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.analytics-header {
    margin-bottom: 40px;
    text-align: center;
}

.analytics-header h1 {
    color: #2d3748;
    margin-bottom: 30px;
}

.summary-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.summary-card {
    background: white;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    text-align: center;
    transition: transform 0.3s ease;
}

.summary-card:hover {
    transform: translateY(-5px);
}

.summary-card h3 {
    color: #718096;
    font-size: 14px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 10px;
}

.summary-card .number {
    font-size: 36px;
    font-weight: bold;
    color: #4299e1;
    margin: 0;
}

.summary-card .location {
    font-size: 20px;
    font-weight: bold;
    color: #38a169;
    margin: 0;
}

.charts-section {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    gap: 30px;
    margin-bottom: 40px;
}

.chart-container {
    background: white;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.chart-container h3 {
    color: #2d3748;
    margin-bottom: 20px;
    text-align: center;
}

.events-list {
    background: white;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin-bottom: 30px;
}

.events-list h3 {
    color: #2d3748;
    margin-bottom: 20px;
}

.events-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
}

.event-card {
    background: #f7fafc;
    border-radius: 8px;
    padding: 20px;
    border-left: 4px solid #4299e1;
}

.event-card h4 {
    color: #2d3748;
    margin-bottom: 10px;
}

.event-card .date {
    color: #718096;
    font-size: 14px;
    margin-bottom: 8px;
}

.event-card .location {
    color: #4a5568;
    font-size: 14px;
    margin-bottom: 10px;
}

.category-tag {
    display: inline-block;
    background: #e6fffa;
    color: #234e52;
    padding: 4px 12px;
    border-radius: 16px;
    font-size: 12px;
    font-weight: 600;
}

.export-section {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 30px;
}

.export-btn, .share-btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.export-btn {
    background: #4299e1;
    color: white;
}

.share-btn {
    background: #38a169;
    color: white;
}

.export-btn:hover {
    background: #3182ce;
    transform: translateY(-2px);
}

.share-btn:hover {
    background: #2f855a;
    transform: translateY(-2px);
}

/* 響應式設計 */
@media (max-width: 768px) {
    .charts-section {
        grid-template-columns: 1fr;
    }
    
    .summary-cards {
        grid-template-columns: 1fr;
    }
    
    .events-grid {
        grid-template-columns: 1fr;
    }
    
    .export-section {
        flex-direction: column;
    }
}
        </div>
        
        <div class="info-box">
            <strong>💡 功能擴展建議：</strong> 
            <ul>
                <li>添加更多統計維度（季節分佈、時間段分佈）</li>
                <li>支援PDF報告生成和下載</li>
                <li>添加社群分享功能（年度旅遊地圖）</li>
                <li>提供個性化旅遊建議（根據歷史數據）</li>
                <li>添加動畫效果提升用戶體驗</li>
            </ul>
        </div>
    </div>

    <div class="page-break"></div>

    <!-- 結論 -->
    <div class="highlight-box">
        <h2>🎯 總結與建議</h2>
    </div>
    
    <div class="function-card">
        <div class="function-header">
            <div class="function-icon">📋</div>
            <div class="function-title">專案成功關鍵因素</div>
        </div>
        
        <h4>✅ 核心優勢</h4>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 15px 0;">
            <div style="background: #e6fffa; padding: 15px; border-radius: 6px;">
                <strong>市場差異化</strong><br>
                • 結合AI與旅遊規劃的創新應用<br>
                • 盲盒體驗和隨機探索的獨特功能<br>
                • 針對台灣旅遊場景的深度優化
            </div>
            <div style="background: #ebf8ff; padding: 15px; border-radius: 6px;">
                <strong>技術可行性</strong><br>
                • 使用成熟的跨平台技術<br>
                • 清晰的技術架構和分工<br>
                • 分階段開發降低風險
            </div>
            <div style="background: #fefcbf; padding: 15px; border-radius: 6px;">
                <strong>用戶價值</strong><br>
                • 解決真實的旅遊痛點<br>
                • 提供完整的使用者旅程<br>
                • 創造情感價值和記憶點
            </div>
            <div style="background: #fed7d7; padding: 15px; border-radius: 6px;">
                <strong>團隊適配</strong><br>
                • 考慮團隊的特殊配置（1 Mac + 4 Windows）<br>
                • 提供具體的協作解決方案<br>
                • 明確的角色分工和責任
            </div>
        </div>
        
        <h4>🚀 執行建議</h4>
        <div class="step-container">
            <div class="step"><strong>立即行動：</strong> 按照MVP規劃開始開發，8週內推出第一個版本</div>
            <div class="step"><strong>用戶反饋：</strong> 積極收集早期用戶反饋，快速迭代改進</div>
            <div class="step"><strong>技術債管理：</strong> 保持代碼質量，建立自動化測試和部署流程</div>
            <div class="step"><strong>市場驗證：</strong> 驗證核心假設，根據市場反饋調整功能優先級</div>
            <div class="step"><strong>團隊協作：</strong> 定期溝通，解決跨平台開發問題，保持團隊同步</div>
        </div>
        
        <h4>📈 成功指標（第一年）</h4>
        <table>
            <tr>
                <th style="width: 30%;">指標類別</th>
                <th style="width: 35%;">目標值</th>
                <th style="width: 35%;">衡量方式</th>
            </tr>
            <tr>
                <td><strong>用戶增長</strong></td>
                <td>10,000 註冊用戶<br>2,000 月活躍用戶</td>
                <td>Google Analytics<br>Firebase Analytics</td>
            </tr>
            <tr>
                <td><strong>用戶參與</strong></td>
                <td>平均每用戶每月<br>創建2個行程<br>使用3次AI功能</td>
                <td>應用內事件追蹤<br>用戶行為分析</td>
            </tr>
            <tr>
                <td><strong>用戶滿意度</strong></td>
                <td>App Store 4.5+評分<br>70% NPS（淨推薦值）</td>
                <td>應用商店評論<br>用戶問卷調查</td>
            </tr>
            <tr>
                <td><strong>功能使用率</strong></td>
                <td>50%用戶使用盲盒功能<br>40%用戶使用AI助手<br>30%用戶使用協作功能</td>
                <td>功能使用統計<br>A/B測試數據</td>
            </tr>
        </table>
        
        <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
            <p style="font-size: 14pt; color: #2d3748; font-weight: bold;">
                「旅行旅上」不僅是一個APP，更是重新定義旅遊體驗的創新平台
            </p>
            <p style="color: #718096; margin-top: 10px;">
                透過智慧技術與人性化設計，讓每一次旅行都成為難忘的體驗
            </p>
        </div>
    </div>

    <div class="footer">
        <p>--- 文件結束 ---</p>
        <p>「旅行旅上」完整功能規格書 v2.0 | 生成時間：2025年12月23日</p>
        <p>總頁數：<span id="page-count">26</span> 頁 | 機密等級：內部使用</p>
        <p style="font-size: 8pt; color: #a0aec0; margin-top: 10px;">
            注意：此文件為技術規格參考，實際開發時需根據團隊能力和市場反饋進行調整。
        </p>
    </div>

</body>
</html>